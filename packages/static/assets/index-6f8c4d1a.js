var Yr=Object.defineProperty;var Qr=(e,t,r)=>t in e?Yr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var ws=(e,t,r)=>(Qr(e,typeof t!="symbol"?t+"":t,r),r);import{c as er,p as en,s as Cs,l as Rs,a as tn,e as Fe,b as vt,m as Oe,d as sn,r as Re,f as We,g as tr,h as Es,w as Ts,i as rn,j as nn,k as rt,n as V,o as sr,q as an,t as on,u as ht,v as ln,x as Qt,y as ze,z as N,A as be,B as es,C as re,D as cn,E as Ke,F as je,G as St,H as dn,R as un,I as pn,J as mn,K as hn,L as gn,M as fn,N as yn,O as xn,P as bn,Q as In,S as jn,T as Ns,U as vn,V as Sn,W as Ds,X as wn,Y as dt,Z as ts,_ as Se,$ as B,a0 as oe,a1 as C,a2 as s,a3 as rr,a4 as Ee,a5 as Q,a6 as wt,a7 as Ct,a8 as q,a9 as Cn,aa as Ie,ab as nr,ac as gt,ad as Ps,ae as Rn,af as En,ag as Tn,ah as Nn,ai as Dn,aj as nt,ak as Pn,al as kn,am as On,an as Wt,ao as H,ap as ee,aq as Ln,ar as Un,as as ar,at as An,au as at,av as ot,aw as ks,ax as Bn,ay as or,az as ss,aA as ir,aB as rs,aC as Fn,aD as lr,aE as Mn,aF as Vn,aG as ns,aH as qn,aI as Gn,aJ as $n,aK as _n,aL as Rt,aM as Et,aN as zt,aO as Hn,aP as as,aQ as cr,aR as Wn,aS as xe,aT as zn,aU as Me,aV as os,aW as pe,aX as ue,aY as dr,aZ as ft,a_ as Zn,a$ as Kn,b0 as ur,b1 as Xn,b2 as Jn,b3 as pr,b4 as Yn,b5 as Qn,b6 as ea,b7 as is,b8 as Xe,b9 as ta,ba as mr,bb as sa,bc as ra,bd as na,be as Ut,bf as aa,bg as oa,bh as ia,bi as la,bj as ca,bk as da,bl as ua,bm as pa,bn as ma,bo as ha,bp as hr,bq as ga,br as fa,bs as ya,bt as xa,bu as ls,bv as ba,bw as Ia,bx as ja,by as va,bz as Sa,bA as wa,bB as Ca,bC as Ra,bD as Ea}from"./vendor-7ad242df.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function r(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(o){if(o.ep)return;o.ep=!0;const a=r(o);fetch(o.href,a)}})();Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{value(e){return this.reduce((t,r)=>t.concat(e.call(this,r)),[])},enumerable:!1});const gr=(e="id")=>t=>{const r={};for(let n=0;n<t.length;n++)r[t[n][e].toString()]=t[n];return r},Ta=Array.isArray,Tt=()=>typeof window<"u"&&typeof window.document<"u",fr=()=>typeof process<"u"&&process.versions!=null&&process.versions.node!=null,Te=async e=>new Promise(t=>setTimeout(t,e));er((e="trace call",t="log",r)=>(...n)=>{const o=new Date().valueOf();if(t==="debugger interrop")debugger;const a=r(...n),i=new Date().valueOf()-o;return console[t](`
`,e,"function "+r.name,"elapsedTime "+i,`
`,...n,`
 => `,`
`,a),a});const yr=(e=[])=>Object.assign(function(n){const o=[];for(let a=0;a<e.length;a++){const i=e[a];if(i[2])debugger;if(i[0](n))return[!1,[i[1]]]}return[!0,o]},{add:(n,o="Error",a=!1)=>yr([...e,[n,o,a]])});yr().add(e=>!/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e),"Please enter a valid email");er((e,t,r)=>{if(e<0||t<0||e>r.length-1||t>r.length-1)return r;const n=r[e],o=r[t];return en(Cs(Rs(e),o),Cs(Rs(t),n))(r)});const me=tn("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz-",15),Na=me,Da="/",Pa=e=>t=>(r,n)=>t(n)?e(r,n):r,ka=e=>e&&e.factory,Oa=e=>t=>ka(e)?t.type.startsWith(e.factory.base):t.type.startsWith(e.base),La=e=>!1;function ge(e,t={}){const r=e?`${e}${Da}`:"";function n(a,i,c=La){const u=r+a,l=Object.assign((f,I,S)=>{const w={type:u,guid:"E-"+me(),...S,payload:f};return(i||I||t)&&(w.meta=Object.assign(t,i,I)),c&&(typeof c=="boolean"||c(f))&&(w.error=!0),w},{reduce:f=>f,type:u,base:r}),p=f=>Pa(f)(d(l)),d=f=>f.type&&f.type===u;return Object.assign(l,{example:{}},{reduce:p,handler:f=>({}),isType:d,matchPayload:f=>I=>I.type===u&&(Fe(f,I.payload)||I.payload instanceof Object&&f instanceof Object&&Object.keys(f).every(S=>f[S]===I.payload[S])),payloadReducerWithInitialState:f=>(I=f,S)=>d(S)?S.payload:I,payloadReducer:(f="",I)=>d(I)?I.payload:f})}function o(a,i){const c=n(`${a}_TRIGGERED`,i,!1),u=n(`${a}_STARTED`,i,!1),l=n(`${a}_DONE`,i,!1),p=n(`${a}_FAILED`,i,!0),d=n(`${a}_EMPTY`,i,!1),y={result:void 0,error:void 0,status:"unset",params:{}};return{isTypeOfAsync:v=>v.type.startsWith(r+a),type:r+a,started:u,triggered:c,defaultState:y,done:l,failed:p,unset:d,asyncReducer:xr(y).case(u,(v,f)=>({...v,result:void 0,error:void 0,status:"started",params:f})).case(l,(v,f)=>({...v,result:f.result,error:void 0,status:"done",params:f.params})).case(p,(v,f)=>({...v,result:void 0,error:f.error,status:"failed",params:f.params})).case(d,v=>({...v,result:void 0,error:void 0,status:"unset",params:void 0}))}}return Object.assign(n,{async:o,base:r,isNamespace:a=>a.type&&a.type.startsWith(e)})}function xr(e){return Ua(e)}function Ua(e){const t={},r=At(e,t);return r.caseWithAction=(n,o)=>(t[n.type]=o,r),r.case=(n,o)=>r.caseWithAction(n,(a,i)=>o(a,i.payload)),r.casesWithAction=(n,o)=>{for(const a of n)r.caseWithAction(a,o);return r},r.cases=(n,o)=>r.casesWithAction(n,(a,i)=>o(a,i.payload)),r.withHandling=n=>n(r),r.default=n=>At(e,{...t},n),r.build=()=>At(e,{...t}),r}function At(e,t,r){return(n=e,o)=>{const a=t[o.type]||r;return a?a(n,o):n}}const Aa=e=>e.actions&&"isCRUD"in e,Ba=(e,t,r=[],n={},o=!0,a=i=>i.app.bootstrap[e])=>{const i=ge(e,{persistent:o}),c=i("patched",{persistent:o}),u=i("added",{persistent:o}),l={reset:i("reset",{persistent:!1}),resetOne:i("resetOne",{persistent:!1}),addedBatch:i("addedBatch",{persistent:o}),updatedBatch:i("updatedBatch",{persistent:o}),patchedBatch:i("patchedBatch",{persistent:o}),removedBatch:i("removedBatch",{persistent:o}),added:u,requested:i("requested",{persistent:!1}),removed:i("removed",{persistent:o}),patched:Object.assign((m,b={})=>{const g={[t]:m[t]};let j=!1;for(const[R,k]of Object.entries(m))Fe(m[R],b[R])||(g[R]=m[R],j=!0);return j?c({...g,[t]:m[t]||b[t]}):void 0},{...c}),updated:i("updated",{persistent:o})},p={requestAdd:i("requestAdd"),requestRemove:i("requestRemove"),requestPatch:i("requestPatch"),requestUpdate:i("requestUpdate")},d={addFailed:i("addFailed"),removeFailed:i("removeFailed"),patchFailed:i("patchFailed"),updateFailed:i("updateFailed")},y=xr([]).case(l.reset,(m,b)=>b).case(l.resetOne,(m,b)=>{const g=m.findIndex(j=>j[t]===b[t]);if(g!==-1){let j=[...m];return j[g]=b,j}return[...m,b]}).cases([d.removeFailed],(m,b)=>typeof b=="number"||typeof b=="string"?{...m,status:"failed"}:m).cases([d.updateFailed,d.patchFailed],(m,b)=>b[t]?{...m,status:"failed"}:m).case(l.added,(m,b)=>vt(Oe(n,b),m)).case(l.addedBatch,(m,b)=>sn(m,b.map(g=>Oe(n,g)))).case(l.removed,(m,b)=>Re(g=>g[t]===b,m)).case(l.removedBatch,(m,b)=>Re(g=>b.includes(g[t]),m)).case(l.updated,(m,b)=>{const g=b[t],j=m.findIndex(k=>k[t]===g);if(j===-1)return We(Oe(n,b),m);const R=m.concat();return R[j]=b,R}).case(l.updatedBatch,(m,b)=>{let g=[...m];return b.forEach(j=>{const R=j[t],k=g.findIndex(te=>te[t]===R);k===-1?g=We(Oe(n,j),g):g[k]={...n,...j}}),g}).case(l.patched,(m,b)=>{const g=b[t],j=m.findIndex(z=>z[t]===g);if(j===-1)return[...m,b];const R=[...m];let k;const te=m[j];try{k=Oe(te,b)}catch(z){console.error(z)}return R[j]=k,R}).case(l.patchedBatch,(m,b)=>{let g=[...m];return b.forEach(j=>{const R=j[t],k=g.findIndex(te=>te[t]===R);k===-1?g=We(Oe(n,j),g):g[k]={...g[k],...j}}),g}),h=m=>b=>{const g=a?a(b):b;for(let j=0;j<g.length;j++)if(g[j][t]===m)return g[j]},v=m=>b=>{const g=a?a(b):b,j=[];for(let R=0;R<g.length;R++)m.includes(g[R][t])&&j.push(g[R]);return j},f=m=>b=>g=>{const j=a?a(g):g,R=[];for(let k=0;k<j.length;k++)j[k][m]===b&&R.push(j[k]);return R},I=m=>Object.assign((g=[],j)=>{var R,k,te,z;if(g=y(g,j),j.type.startsWith(e)){let Z=j.payload[t];if(Z||((R=j==null?void 0:j.payload)!=null&&R.params&&(Z=(k=j.payload)==null?void 0:k.params[t]),!Z&&((te=j==null?void 0:j.payload)!=null&&te.result)&&(Z=(z=j.payload)==null?void 0:z.result[t])),Z){const De=g.find(D=>D[t]===Z),we=g.findIndex(D=>D[t]===Z);if(De){const D=m(De,j);D!==De&&(g=[...g],g[we]=D)}}}return g},{duck:P}),S=tr(m=>gr(t)(m)),w=m=>a(m),T=m=>S(w(m)),P={getId:m=>m[t],factoryPrefix:e,idProp:t,idKey:t,factory:i,commands:p,indicies:r,plural:e,getItemName:m=>m[t],actions:{...l,...p,...d},reducer:y,concatItemReducer:I,isCRUD:!0,isValid:(m,b)=>{if(l.added.isType(b)){const g=b.payload[t];if(h(g)(m))return"Id "+g+" already exists in "+e+" collection"}},selectAll:w,selectAllAsMap:T,selectMap:T,selectList:w,selectAllExceptById:m=>b=>{const g=a?a(b):b,j=[];for(let R=0;R<g.length;R++)g[R][t]!==m&&j.push(g[R]);return j},selectById:m=>b=>{try{return T(b)[m]}catch(g){console.error(g);return}},selectManyByIds:v,selectPropEq:f,selectEq:m=>b=>{const g=a?a(b):b;return Es(Ts(m),g)},selectEqOne:m=>b=>{const g=a?a(b):b;return Es(Ts(m),g)[0]},select:m=>b=>{const g=a?a(b):b,j=[];for(let R=0;R<g.length;R++)rn(m)(g[R])&&j.push(g[R]);return j},isEventAffectsItemId:m=>b=>{if(i.isNamespace(m))return l.removed.isType(m)?m.payload===b:l.removedBatch.isType(m)?m.payload.includes(b):l.added.isType(m)||l.updated.isType(m)||l.patched.isType(m)?m.payload[t]===b:l.addedBatch.isType(m)||l.updatedBatch.isType(m)||l.patchedBatch.isType(m)?m.payload.find(g=>g[t]===b):!1}};return P},br=(e,t={},r=!0,n=o=>o.app.bootstrap[e])=>{const o=ge(e,{persistent:r}),a={reset:o("reset",{persistent:!1})};return{...o,actions:a,select:n,reducer:(c=t,u)=>a.reset.isType(u)?u.payload:c,factoryPrefix:e}},Ir={},Os=br("config",Ir),Fa={...Os,selectConfig:e=>e.app.config,selectApiConfig:e=>e.app.config.mode==="DEV"?e.app.config.DEV:e.app.config.PROD,reducer:(e=Ir,t)=>Os.actions.reset.isType(t)?t.payload:e},jr={statuses:[],roles:[]},Ls=br("settings",jr),vr={...Ls,selectSettings:e=>e.app.bootstrap.settings,selectStatuses:e=>e.app.bootstrap.settings.statuses,selectStatusById:e=>t=>t.app.bootstrap.settings.statuses.find(r=>r.statusId===e),reducer:(e=jr,t)=>Ls.actions.reset.isType(t)?t.payload:e},de=e=>Object.assign((t={})=>({type:e,tsType:{},name:"string",...t}),{type:e}),Ma=(e,t)=>({...e,name:t}),Va=nn(Ma),qa=e=>({...e,type:"array",properties:Va(e.properties),tsType:{}}),Ga=e=>({...e,type:"item"}),$a=e=>({...e,type:"itemOf"}),_a=e=>({...e,type:"date"}),Ha=e=>({...e,type:"arrayOf"}),Wa=e=>({...e,type:"enum"}),za=e=>e&&e.type==="enum",Ve=e=>e&&e.type==="itemOf",x={date:_a,text:de("text"),string:de("string"),enum:Wa,boolean:de("boolean"),number:de("number"),int:de("int"),item:Ga,any:de("any"),uint:de("uint"),array:qa,arrayOf:Ha,itemOf:$a,datetime:de("datetime"),timestamp:de("timestamp"),daterange:de("daterange")};x.date({}),x.string({});const Bt=()=>Tt()?window.store:void 0,Za=e=>e.slice(-1)==="s"?e+"es":e+"s",Ne=(e,t,{langRU:r,...n})=>{const o=Za(e),a=e+"Id",i={[a]:x.string({headerName:"id",isIDProp:!0,unique:!0})},c={langRU:r,RID:e,idProp:a,collection:o,properties:{...i,...t,removed:x.string({headerName:"Удалёно",sealed:!0})},exampleItem:{}},u=[];Object.keys(c.properties).forEach(f=>{const I=c.properties[f];u.push(I),I.name=f,I.headerName=I.headerName||I.name});const l=f=>{const I=f,S=u[1].name;return I[S]},p=n.getItemName||l,{idProp:d,...y}=Ba(o,a),h=f=>f.app.bootstrap[c.collection].reduce((S,w)=>{const T=p(w);return S[T]=w,w[`${e}Name`]||(w[`${e}Name`]=T),S},{}),v={getPropByName:f=>t[f],rid:e,idMeta:c.properties[a],fieldsList:u,...y,idProp:a,fields:t,asOptions:(f=void 0)=>{const S=Bt().getState(),T=(f||y.selectList(S)).map(P=>({value:String(P[d]),label:p(P)}));return console.log("asOptions",T),T},selectFirstByName:f=>I=>y.selectList(I).find(w=>p(w)===f),selectMapByNames:h,resourceName:o.toUpperCase(),asValueEnum:(f=void 0)=>{const I=Bt().getState(),S=f||y.selectList(I),w={};return console.log(y.factoryPrefix+" list of "+y.factoryPrefix,f),S.map(T=>{console.log("item",T),w[String(T[d])]=String(p(T))}),console.log("asValueEnum",w),w},getItemName:p,...n,...c,getStore:Bt};return{...v,isResource:f=>f.rid===v.rid}};Ne("test",{brandName:x.string()},{langRU:{singular:"заказчик",some:"заказчиков",plural:"заказчики"}});const ke=e=>t=>{const r=e.selectList(t),n=gr(e.idProp)(r),o=e.selectMapByNames(t),a={},i=c=>{const u={};r.forEach(l=>{u[l[c.name]]||(u[l[c.name]]=[]),u[l[c.name]].push(l)})};return{list:r,byId:n,byName:o,byRes:c=>(a[c]||(a[c]=i(e.properties[c])),u=>a[c][u]||[])}},Ka=e=>{let t=String(e).split("");return Math.abs(t.reduce((r,n)=>r=n.charCodeAt(0)+(r<<6)+(r<<16)-r,0))},Xa=["руководитель","менеджер","сметчик","техник","ответственный инженер"],it=Ne("user",{role:x.enum({required:!0,enum:Xa,headerName:"Роль"}),brandId:x.itemOf({headerName:"Организация",linkedResourceName:"BRANDS"}),lastname:x.string({required:!0,colDef:{width:250},headerName:"Фамилия"}),name:x.string({required:!0,colDef:{width:250},headerName:"Имя"}),title:x.string({headerName:"Должность",colDef:{width:200}}),email:x.string({required:!0,toLowerCase:!0,colDef:{width:250}}),phone:x.string({toLowerCase:!0,colDef:{width:250}}),avatarUrl:x.string({colDef:!1}),password:x.string({required:!0,colDef:!1}),removed:x.boolean({select:!1,colDef:!1,internal:!0})},{getItemName:e=>e.lastname+" "+e.name,langRU:{singular:"Пользователь",plural:"Пользователи",some:"Пользователя"}}),Us=e=>t=>{const r=t.app.bootstrap.users;return e?r.find(o=>o.email&&o.email.toLowerCase()===e.toLowerCase()):void 0};var As=["#775DD0","#FF9800","#A5978B","#FD6A6A","#69D2E7","#C5D86D","#E2C044","#C4BBAF","#00B1f2","#8b71e4","#ffac14","#b9ab9f","#ff7e7e","#7de6fb","#d9ec81","#f6d458","#d8cfc3","#14c5ff"],Ja=(e,t,r)=>{const n=e%As.length,o=As[n];rt.contrast(o,"#f5f6f9"),rt.contrast(o,"#383a3e");const a=rt.contrast(o,"#f5f6f9")>rt.contrast(o,"#383a3e")?"f5f6f9":"383a3e";return`https://ui-avatars.com/api/?background=${o.substring(1)}&font-size=${.4}&color=${a}&format=svg&name=${t}+${r}`};const Bs=e=>{const t=(e.fullName||"Новый Пользователь Отчество").split(" "),r=n=>{const o=t[n];return n===0?o:o&&o.length?" "+o[0]+".":""};return r(0)+r(1)+r(2)},Ge={...it,getItemName:e=>Bs(e),actions:{...it.actions},selectUserByEmail:Us,selectAbbrName:e=>t=>{const r=it.selectById(e)(t);return Bs(r)},selectUserByCredentials:({email:e,password:t})=>r=>{const n=Us(e)(r);return n&&n.password===t?n:void 0},selectAvatar:e=>t=>{const r=it.selectById(e)(t);if(r.avatarUrl)return r.avatarUrl;const n=Ka(e);return Ja(n,r.name?r.name.charAt(0):"",r.lastname?r.lastname.charAt(0):"")}},$=Ge,Ya=Ne("site",{brandId:x.itemOf({headerName:"Заказчик",linkedResourceName:"BRANDS",required:!0}),legalId:x.itemOf({headerName:"Юр. Лицо",linkedResourceName:"LEGALS",required:!0,filterLinkedResourceItems:(e,t)=>e.filter(r=>r.brandId===t.brandId)}),city:x.string({headerName:"Город",required:!0}),address:x.string({headerName:"Адрес",required:!0}),contactInfo:x.text({headerName:"Контакты"}),KPP:x.string({headerName:"КПП"}),managerUserId:x.itemOf({headerName:"Менеджер",linkedResourceName:"USERS",defaultAsPropRef:"legalId"}),techUserId:x.itemOf({headerName:"Техник",linkedResourceName:"USERS"}),clientsEngineerUserId:x.itemOf({headerName:"Отв. инженер",linkedResourceName:"USERS",defaultAsPropRef:"legalId"})},{getItemName:e=>e.city+", "+e.address,langRU:{singular:"Адрес",plural:"Адреса",some:"Адресов"}}),F=Ya,Qa=["Новый","Действующий","Завершён"],eo=Ne("contract",{contractNumber:x.string({headerName:"Номер договора"}),brandId:x.itemOf({headerName:"Заказчик",linkedResourceName:"BRANDS",required:!0,immutable:!0}),legalId:x.itemOf({headerName:"Юр. Лицо",linkedResourceName:"LEGALS",required:!0,immutable:!0}),signDate:x.date({headerName:"Дата подписания"}),endDate:x.date({headerName:"Дата окончания"}),contractStatus:x.enum({headerName:"Статус договора",enum:Qa}),rate:x.number({headerName:"Ставка"}),managerUserId:x.itemOf({headerName:"Менеджер",linkedResourceName:"USERS",defaultAsPropRef:"legalId"})},{langRU:{singular:"Договор",plural:"Договоры",some:"Договора"}}),_={...eo};function to(){return this.format("YYYY/MM/DD")}const so=(e,t,r)=>{t.prototype.toString=to,t.prototype.isInPeriod=function([n,o]){const a=this;return!n&&!o?!0:o?n?this.isBetween(n,o,"day","[]"):this.isBefore(o,"day")||a.isSame(o):this.isAfter(n,"day")||a.isSame(n)}};V.extend(sr);V.extend(so);V.extend(an);V.extend(on);const Ue=e=>e?V(e).startOf("d"):void 0,Sr=()=>V().startOf("d");var Fs=Sr(),Ms=new Date().getTime();const cs=()=>(Ms+1e3*60>new Date().getTime()&&(Fs=Sr(),Ms=new Date().getTime()),Fs),Nt=e=>e?Ue(e):cs(),ro=e=>e===void 0?void 0:Ue(e),ds=e=>({plannedDay:Ue(e.plannedDate),completedDay:Ue(e.completedDate),workStartedDay:Ue(e.workStartedDate),registerDay:Ue(e.registerDate)}),wr=e=>{const{plannedDay:t,completedDay:r,registerDay:n,workStartedDay:o}=ds(e);if(console.log(t?t.toString():"-",r?r.toString():"-"),t){const a=Nt(e.completedDate);if(a.isAfter(t))return a.diff(t,"day")}return 0},no=e=>!(e.status==="Отменена"||e.status==="Приостановлена"),us=e=>wr(e)>0,ao=us,Je=e=>(t,r=!1)=>n=>n[e]?V(n[e]).isInPeriod(t):r,Cr=Je("registerDay"),Rr=Je("completedDay"),Er=Je("workStartedDay"),Tr=Je("plannedDay"),oo=e=>t=>Cr(e)(t)||Rr(e)(t)||Tr(e)(t)||Er(e)(t),io=e=>{},lo=e=>t=>{if(oo(e)(t))return!0;const{plannedDay:r,completedDay:n,registerDay:o,workStartedDay:a}=ds(t);return Nt(e[1]),!!(!n&&o&&o.isBefore(cs()))},co=e=>e?Nt(e).toString():"Дата не указана",Nr=Object.freeze(Object.defineProperty({__proto__:null,asDay:Ue,asDayOrToday:Nt,asDayOrUndefined:ro,getIssueDays:ds,getIssueDelayOrUndefined:wr,isAnyDayBefore:io,isCompletedIn:Rr,isDayPropInPeriod:Je,isIssueActive:no,isIssueDelayed:ao,isIssueInPeriod:lo,isIssueOutdated:us,isPlannedIn:Tr,isRegisteredIn:Cr,isWorkStartedIn:Er,toDayString:co,today:cs},Symbol.toStringTag,{value:"Module"})),uo=Nr,ps=["Новая","В работе","Выполнена","Отменена","Приостановлена"],Dr={Новая:["В работе"],"В работе":["Выполнена","Отменена","Приостановлена"],Выполнена:[],Отменена:[],Приостановлена:[]},Pr={"В работе":"yellow",Новая:"blue",Выполнена:"green",Отменена:"lightgrey",Приостановлена:"grey"},Vs=["Наличные","Безналичные"],po=Ne("issue",{clientsIssueNumber:x.string({headerName:"Номер заявки",required:!0,immutable:!0}),status:x.enum({headerName:"Статус",enum:ps}),brandId:x.itemOf({headerName:"Заказчик",linkedResourceName:"BRANDS",required:!0,immutable:!0}),legalId:x.itemOf({headerName:"Юр. Лицо",linkedResourceName:"LEGALS",required:!0,immutable:!0}),contractId:x.itemOf({headerName:"Договор",linkedResourceName:"CONTRACTS",required:!0,immutable:!0}),siteId:x.itemOf({headerName:"Объект",linkedResourceName:"SITES",required:!0,immutable:!0}),subId:x.itemOf({headerName:"Подписка",linkedResourceName:"SUBS",required:!0,immutable:!0,internal:!0}),registerDate:x.date({headerName:"Зарегистрировано",internal:!0}),workStartedDate:x.date({headerName:"Начало работ"}),plannedDate:x.date({headerName:"Запланировано"}),completedDate:x.date({headerName:"Дата завершения"}),description:x.text({headerName:"Описание"}),removed:x.boolean({select:!1,internal:!0}),expensePrice:x.number({headerName:"Расходы",internal:!0}),expenses:x.array({headerName:"Список расходов",properties:{paymentType:x.enum({enum:Vs}),title:x.string(),amount:x.number(),comment:x.string(),date:x.date({headerName:"Дата"})}}),estimations:x.array({headerName:"Смета",properties:{paymentType:x.enum({enum:Vs}),title:x.string(),amount:x.number(),comment:x.string()}}),estimationPrice:x.number({headerName:"Смета сумма"}),workFiles:x.array({properties:{url:x.string()}}),actFiles:x.array({properties:{url:x.string({required:!0})}}),checkFiles:x.array({properties:{url:x.string()}}),estimationsApproved:x.boolean({headerName:"Смета согласована",internal:!0}),contactInfo:x.text({headerName:"Контакты"}),managerUserId:x.itemOf({headerName:"Менеджер",linkedResourceName:"USERS",defaultAsPropRef:"siteId"}),techUserId:x.itemOf({headerName:"Техник",linkedResourceName:"USERS",defaultAsPropRef:"siteId"}),clientsEngineerUserId:x.itemOf({headerName:"Отв. инженер",linkedResourceName:"USERS",defaultAsPropRef:"siteId"})},{nameProp:"clientsIssueNumber",langRU:{singular:"Заявка",plural:"Заявки",some:"Заявки"}}),mo=e=>{const t=F.selectById(e.siteId)(F.getStore().getState());return`${e.clientsIssueNumber} по адресу ${t?t.city+t.address:" НЕ УКАЗАН "} от ${uo.toDayString(e.registerDate)}`},ho={...po,getIssueTitle:mo},E=ho,J=Ne("brand",{brandName:x.string({required:!0,headerName:"Компания",unique:!0}),brandType:x.enum({required:!0,headerName:"Сторона",enum:["Заказчик","Исполнитель"]}),person:x.string({headerName:"Контактное лицо"}),email:x.string({headerName:"Email"}),phone:x.string({headerName:"Телефон"}),address:x.string({headerName:"Адрес"}),web:x.string({headerName:"Вебсайт"}),managerUserId:x.itemOf({headerName:"Отв. менеджер",linkedResourceName:"USERS"}),removed:x.boolean({select:!1,colDef:!1,internal:!0})},{nameProp:"brandName",langRU:{singular:"Заказчик",plural:"Заказчики",some:"Заказчика"}}),Zt=Ne("legal",{legalName:x.string({headerName:"Юр. Лицо",required:!0}),region:x.string({headerName:"Регион",required:!1}),brandId:x.itemOf({headerName:"Заказчик",linkedResourceName:"BRANDS",required:!0})},{langRU:{singular:"Юр. Лицо",plural:"Юр. Лицa",some:"Юр. Лиц"}}),go=e=>t=>{const n=Zt.selectAll(t).filter(o=>o.brandId===e);return Zt.asValueEnum(n)},G={...Zt,selectValueEnumByBrandId:go},se=Ne("sub",{contractId:x.itemOf({headerName:"Договор",linkedResourceName:"CONTRACTS",required:!0,immutable:!0}),subscribeDate:x.date({headerName:"Дата подключения"}),unsubscribeDate:x.date({headerName:"Дата отключения"}),siteId:x.itemOf({headerName:"Объект",linkedResourceName:"SITES",required:!0}),rate:x.number({headerName:"Ставка"}),managerUserId:x.itemOf({headerName:"Менеджер",linkedResourceName:"USERS"})},{langRU:{singular:"Подключение",plural:"Подключения",some:"Подключений"}}),Kt=ge("bootstrap"),fo={fetchBootstrap:Kt.async("fetchBootstrap"),serverStateBootstraped:Kt("serverStateBootstraped")},yo={users:Ge,sites:F,contracts:_,issues:E,brands:J,legals:G,subs:se},ms={...yo,config:Fa,settings:vr},xo=Object.values(ms);xo.filter(Aa);const bo=e=>{const t={};return Object.keys(e).forEach(r=>t[e[r].factoryPrefix]=e[r].reducer),t},Io=ht(bo(ms)),hs={reducer:Io,factory:Kt,actions:fo,selectBootstrap:e=>e.app.bootstrap},yt=e=>{e.app.bootstrap;const t=ke(Ge)(e),r=ke(F)(e),n=ke(_)(e),o=ke(E)(e),a=ke(J)(e),i=ke(G)(e),c=ke(se)(e),u={brands:a,legals:i,subs:c,users:t,sites:r,contracts:n,issues:o};return{...u,getLinkedResByName:(l,p)=>u[l.toLowerCase()].byName[p],getLinkedResById:(l,p)=>u[l.toLowerCase()].byId[p]}},M=ge("ui"),W={preloaded:M("PRELOADED"),setPending:M("setPending"),removePending:M("removePending"),busy:M("busy"),unbusy:M("unbusy"),setLang:M("setLang"),setTheme:M("setTheme"),showModal:M("showModal"),hideModal:M("hideModal"),showToast:M("showToast"),hideToast:M("hideToast"),setShowMemo:M("setShowMemo"),showConfirm:M("showConfirm"),hideConfirm:M("hideConfirm"),setLogin:M("setLogin"),setSeqNum:M("setSeqNum"),loginRequested:M("loginRequested"),loggedIn:M("loggedIn"),loggedOut:M("loggedOut"),logout:M("logout"),setLogRocketURL:M("setLogRocketURL"),setMode:M("setMode")},qs={text:void 0,title:void 0,action:void 0},jo=(e=qs,t)=>W.showConfirm.isType(t)?t.payload:W.hideConfirm.isType(t)?qs:e,vo=(e="dark",t)=>W.setTheme.isType(t)?t.payload:e,So=(e=[],t)=>W.busy.isType(t)?vt(t.payload,e):W.unbusy.isType(t)?Re(Fe(t.payload),e):W.unbusy.isType(t)?Re(Fe(t.payload),e):e,wo=(e=[],t)=>W.showModal.isType(t)?vt(t.payload,e):W.hideModal.isType(t)?Re(Fe(t.payload),e):e,Co=(e=[],t)=>W.showToast.isType(t)?vt(t.payload,e):W.hideToast.isType(t)?Re(r=>r===t.payload.id,e):e,Ro=(e="",t)=>W.setPending.isType(t)?t.payload:W.removePending.isType(t)?"":e,Eo=ht({pending:Ro,busy:So,modals:wo,toasts:Co,theme:vo,confirm:jo,preloaded:(e=!1,t)=>W.preloaded.isType(t)?!0:e,seqNum:W.setSeqNum.payloadReducer,logRocketURL:W.setLogRocketURL.payloadReducer,login:W.setLogin.payloadReducer}),To=e=>e.ui,O={actions:W,reducer:Eo,selectUI:To,selectPending:e=>e.ui.pending},Gs="SSE_REDUX_EVENT",Y=ge("sseClientConnection"),Ce={factory:Y,connected:Y("CONNECTED"),disconnected:Y("DISCONNECTED"),error:Y("ERROR"),failed:Y("FAILED"),gatewayChanged:Y("GATEWAY_CHANGED"),fetchStateRequested:Y("FETCH_STATE_REQUESTED"),fetchStateSuccessed:Y("FETCH_STATE_SUCCESSED"),fetchStateFailed:Y("FETCH_STATE_FAILED"),serverPushed:Y("SERVER_PUSHED"),clientPushStarted:Y("CLIENT_PUSH_STARTED"),clientPushSuccess:Y("CLIENT_PUSH_SUCCESS"),clientPushFailed:Y("CLIENT_PUSH_FAILED")},No={pushingEvents:[],completedPushes:[],failedPushes:[],isConnected:!1},Do=(e=No,t)=>Ce.clientPushStarted.isType(t)?{...e,pushingEvents:[t.payload,...e.pushingEvents]}:Ce.clientPushFailed.isType(t)?{...e,pushingEvents:e.pushingEvents.filter(r=>t.payload.guid!==r.guid),failedPushes:[t,...e.failedPushes]}:Ce.clientPushSuccess.isType(t)?{...e,pushingEvents:e.pushingEvents.filter(r=>t.payload.guid!==r.guid),completedPushes:[t,...e.completedPushes]}:Ce.connected.isType(t)?{...e,isConnected:!0,error:void 0}:Ce.disconnected.isType(t)?{...e,isConnected:!1}:Ce.error.isType(t)?{...e,error:t.payload,isConnected:!1}:Ce.gatewayChanged.isType(t)?{...e,gateway:t.payload,error:void 0,isConnected:!1}:e,Po=e=>e.app.conn,ye={reducer:Do,actions:Ce,factory:Y,select:Po},$e={USERS:$,BRANDS:J,LEGALS:G,SITES:F,CONTRACTS:_,SUBS:se,ISSUES:E},kr=[$,J,G,F,_,se,E],xt=e=>$e[e],ko=e=>kr.find(t=>t.factory.isNamespace(e));Tt()&&(window.RES=$e);const $s=e=>e&&e.meta&&e.meta.persistent===!0,Le={setItem:(e,t)=>typeof t>"u"?localStorage.removeItem(e):localStorage.setItem(e,JSON.stringify(t)),removeItem:e=>localStorage.removeItem(e),getItem:(e,t)=>{let r;try{const n=localStorage.getItem(e);n&&(r=JSON.parse(n))}catch(n){console.error("Error while access localStorage with key",e,n)}return typeof r<"u"?r:t}},Oo=(e="App printman")=>ln({name:e,trace:!0,traceLimit:25,latency:200,maxAge:200}),Xt=ge("meta"),Lo={storeGuid:me(),userId:"service"},Or={metaUpdated:Xt("metaUpdated"),eventHandled:Xt("eventHandled")},Uo=(e=Lo,t)=>Or.metaUpdated.isType(t)?{...e,...t.payload}:e,Dt={reducer:Uo,actions:Or,factory:Xt,selectMeta:e=>e.meta},he=Nr;he.today();const Pt=async()=>{const e=Qt;return{getNewGToken:async()=>(await e.get("/api/gapis/get-token")).data.token,emailExport:async t=>(await e.post("/api/email-export",t)).data,login:async t=>(await e.post("/api/user/login",t)).data,fetchBootstrap:async t=>(await e.post("/api/bootstrap",t)).data,loadPro:async t=>(await e.post("/api/project/"+t)).data,pushCommands:async t=>{const n={events:(Ta(t)?t:[t]).map(a=>({...a,sourceUserId:1,storeGuid:1}))};return(await e.post("/api/push-commands",n)).data}}},Ft=[];function*Ao(){yield*ze(ye.actions.serverPushed.isType,function*(n){if(!Ft.includes(n.payload.guid)){const o={...n.payload,external:!0};yield*N(o)}});function*e(n){const o=dn(a=>{let i=new un(n);const c=p=>{console.log("SSE message",p),p.type===Gs&&a(JSON.parse(p.data))},u=p=>{console.error("SSE error",p),a(ye.actions.error(JSON.stringify(p))),a(pn)},l=p=>{a(ye.actions.connected(void 0))};return i.addEventListener(Gs,c),i.addEventListener("error",u),i.addEventListener("open",l),i.addEventListener("disconnect",p=>{console.log("Disconnected",p)}),()=>{i&&i.close()}});for(;;){const a=yield*Ke(o);window.store.appliedGuids.includes(a.guid)||(window.store.appliedGuids.push(a.guid),yield*N(a))}}function*t(){yield*es(Dt.actions.metaUpdated.isType,function*(n){n.payload.userId==="admin"?yield*e("/api/sse/admin?"+new URLSearchParams(n.payload).toString()):n.payload.userId!=="guest"&&(yield*e("/api/sse/user?"+new URLSearchParams(n.payload).toString()))})}function*r(){const n=yield*re(Pt),o=yield*cn($s);for(;;){const a=yield*Ke(o),i=yield*je(d=>d.meta),c=yield*je(d=>d.app.conn.gateway),u=new URLSearchParams(c),l=u.get("storeGuid");if((u.get("userId")||"guest")!=="0"&&!Ft.includes(a.guid)&&(a.storeGuid===void 0||a.storeGuid===i.storeGuid)&&!a.external){Ft.push(a.guid),a.storeGuid=l,i.userId!=="guest"&&i.userId!=="admin"&&i.userId!=="service"&&i.userId&&!a.userId&&(a.userId||(a.userId=a.payload?a.payload.userId:i.userId)),a.userId?a.userId=a.userId:a.userId="admin";let d=St(a);if(i.userId&&Oa(Ge.factory)(a)||$s(a)){yield*N(ye.actions.clientPushStarted(a));try{const y=yield*re(n.pushCommands,[d]);yield*N(ye.actions.clientPushSuccess(a))}catch(y){yield*N(ye.actions.clientPushFailed({action:a,error:y}))}}}}}yield*be(t),yield*be(r)}$.rid="user";$.idProp="userId";const Bo={settingsDuck:vr,metaDuck:Dt,USERS:$,ISSUES:E,CONTRACTS:_,SITES:F},Fo={VERSION:"",COMMITHASH:"",BRANCH:"",LASTCOMMITDATETIME:"",LOG_ROCKET:"",SERVICE_PORT:9181,WEBPACK_PORT:9380},Lr=ge("frontConfig"),_s={reset:Lr("reset")},Ur={factory:Lr,actions:_s,selectFrontConfig:e=>e.frontConfig,reducer:(e=Fo,t)=>_s.reset.isType(t)?t.payload:e},{connectRouter:Mo,routerMiddleware:Hs,ConnectedRouter:Vo,LOCATION_CHANGE:Ar}=gn,Ze=Tt()?mn():hn(),qo=()=>Ze,Go=e=>{const t=(n,o={})=>{let a=Object.entries(n||{}).reduce((c,[u,l])=>c.replace(":"+u,String(l)),e);return Object.keys(o).length&&(a+="?"+new URLSearchParams(o).toString()),a},r=(n,o={isExact:!0})=>fn(n,{path:e,...o});return Object.assign(t,{build:({params:n,...o})=>({...o,pathname:n?t(n):t()}),match:r,pattern:e,isSameLocationAction:(n,o=!0)=>n.type.includes(Ar)&&n.payload&&n.payload.location&&n.payload.location.pathname&&n.payload.location.pathname!==null&&n.payload.location.pathname!==void 0&&r(n.payload.location.pathname)&&(o?r(n.payload.location.pathname).isExact===!0:!0)})},$o=e=>t=>yn(e(t)),Ws=e=>t=>xn(e(t)),Mt=ge("router"),ut={backOrReplacePage:Mt("backOrReplace"),pushPage:Mt("pushPage"),replacePage:Mt("replacePage")};function*_o(e){yield*ze(ut.backOrReplacePage.isType,function*(r){(yield*je(Br)).history.length>1?yield*N(bn()):yield*N(Ws(r.payload))}),yield*ze(ut.pushPage.isType,function*(r){yield*N($o(r.payload.url,r.payload.state))}),yield*ze(ut.replacePage.isType,function*(r){yield*N(Ws(r.payload.url,r.payload.state))})}const Br=e=>e.router,Ho=e=>{const t=Mo(e),r=(a=[],i)=>{if(i.type===Ar){const c=i;return c.payload.isFirstRendering?[c.payload.location]:c.payload.action==="POP"?Ns(a):c.payload.action==="PUSH"?We(c.payload.location,a):[c.payload.location,...Ns(a)]}return a},n={history:[],...t()};return(a=n,i)=>i.type===In?{...t(a,i),history:r(a.history,i)}:i.type===jn?{...t(a,i),history:r(a.history,i)}:a},Wo={actions:ut,getReducer:Ho,selectRouter:Br},pt=ge("loading"),mt={show:pt("show"),hide:pt("hide"),clear:pt("clear")},zo=[],Zo=(e=zo,t)=>mt.clear.isType(t)?[]:mt.show.isType(t)?We(t.payload,e):mt.hide.isType(t)?Re(Fe(t.payload),e):e,Ko={factory:pt,reducer:Zo,actions:mt};class Xo{constructor(t){ws(this,"store");this.store={...t}}getItem(t){return this.store[t]||null}hasItem(t){return this.store!==void 0}setItem(t,r){this.store[t]=r.toString()}removeItem(t){delete this.store[t]}}new Xo({});const Ae=()=>localStorage;console.log("isNode",fr);console.log("nowStorage is",Ae());const Jo=()=>({setItem:(e,t)=>typeof t>"u"?Ae().removeItem(e):Ae().setItem(e,JSON.stringify(t)),removeItem:e=>Ae().removeItem(e),hasItem:e=>Ae().getItem(e)!==void 0,getItem:(e,t)=>{let r;try{const n=Ae().getItem(e);n&&(r=JSON.parse(n))}catch(n){console.error("Error while access localStorage with key",e,n)}return typeof r<"u"?r:t}}),Be=()=>Jo();console.log("isNode",fr);console.log("nowStorage is",Be());const zs=e=>({setItem:(t,r)=>typeof r>"u"?Be().removeItem(`${e}:${t}`):Be().setItem(`${e}:${t}`,JSON.stringify(r)),removeItem:t=>Be().removeItem(`${e}:${t}`),hasItem:t=>Be().getItem(`${e}:${t}`)!==void 0,getItem:(t,r)=>{let n;const o=`${e}:${t}`;try{const a=Be().getItem(o);a&&(n=JSON.parse(a))}catch(a){console.error("Error while access localStorage with key",o,a)}return typeof n<"u"?n:r}}),Jt=ge("preferences"),bt={setKey:Jt("setKey"),localUserPreferencesLoaded:Jt("localUserPreferencesLoaded")};function*Yo(){yield*es(O.actions.loggedIn.isType,Qo)}function*Qo(e){const t=e.payload.email,r="preferences";let n=Fr;const o=zs(t);if(o.hasItem(r)){const a=o.getItem(r);n={...n,...a}}return yield*N(bt.localUserPreferencesLoaded(n)),yield*es(It.actions.setKey.isType,function*(a){const i=yield*je(It.selectPreferences);zs(t).setItem(r,i)}),n}const Fr={role:0,toastsEventsFeed:!0,animatedColors:!1,ionModeMaterial:!1,darkMode:!1,showExamples:!1,showFPS:!1},ei=(e=Fr,t)=>bt.setKey.isType(t)?{...e,[t.payload.key]:t.payload.value}:e,ti=e=>e.app.preferences,It={actions:bt,reducer:(e,t)=>bt.localUserPreferencesLoaded.isType(t)?t.payload:ei(e,t),selectPreferences:ti,factory:Jt},si=e=>{const t=Wo.getReducer(e),n=ht({router:t,app:ht({bootstrap:hs.reducer,conn:ye.reducer,preferences:It.reducer}),loading:Ko.reducer,meta:Dt.reducer,ui:O.reducer,frontConfig:Ur.reducer});return(o,a)=>n(o,a)},gs=e=>{const t=e.ui.login;return Ge.selectUserByEmail(t)(e)},Vt=[],ri="__REDUX_DEVTOOLS_EXTENSION__",ni=(e,t=qo())=>{const r=Sn(si(t),e,ai(t));r.appliedGuids=Vt,r.runSaga=Yt.run;const n=r.dispatch;let o="?";return r.dispatch=a=>{if(a===void 0)debugger;const i=gs(r.getState()),c=r.getState(),u=i?i.userId:void 0;if(a){if(u&&a.meta&&a.meta.persistent&&!a.userId)if(a={...a,userId:u,meta:{...a.meta,userId:u}},a={...a},a.guid||(a.guid=Na()),a.storeGuid||(a.storeGuid=c.meta.storeGuid),a.timestamp||(a.timestamp=new Date().toISOString()),!Vt.includes(a.guid))a.payload&&a.payload.userId&&(a.userId=a.payload.userId),Vt.push(a.guid);else return;try{a&&a.type==="@printman/router/LOCATION_CHANGE"?o!==a.payload.location.pathname&&(o=a.payload.location.pathname,n(a)):n(a)}catch(l){console.error(l)}}},r},Yt=vn(),ai=e=>Tt()&&window[ri]?Oo("RENGIN")(Ds(Hs(e),Yt)):wn(Ds(Hs(e),Yt));let Zs=[];function*Mr(){yield*ze(e=>!!ye.actions.clientPushSuccess.isType(e),function*(e){if(Zs.includes(e.guid))return;Zs.push(e.guid);const t=e.payload,r=ko(t),n=yield*je(r.selectById(t.payload[r.idProp]));if(r&&n){const o=r.getItemName(n);r.actions.added.isType(t)?dt.open({message:o+" добавлен",description:"Вы добавили новый "+r.langRU.some,type:"success"}):r.actions.updated.isType(t)||r.actions.patched.isType(t)?dt.open({message:o,description:"Вы обновили "+r.langRU.some,type:"info"}):r.actions.removed.isType(t)&&dt.open({message:o,description:"Запись "+r.langRU.some+" удалена",type:"warning"})}})}class Vr{}Vr.getSSERoute=e=>(console.log("Location : "+window.location),window.location.host+"/sse/user&"+new URLSearchParams(e).toString());const oi=ts,qr=Se,Gr=()=>B(O.selectUI),ii=()=>{const[e,t]=dt.useNotification(),r=qr(),n=Gr();oe(),oi(),C.useState(!1);const[o,a]=C.useState(window.location.hostname==="localhost"?"miramaxis@gmail.com":void 0),[i,c]=C.useState(window.location.hostname==="localhost"?"123456":void 0),[u,l]=C.useState(!1),[p,d]=C.useState(!1),y=async h=>{if(h.preventDefault(),!i)return;const v={password:i,email:o,remember:u,pathname:window.location.pathname};JSON.stringify(v),d(!0);try{const I=await(await Pt()).login(v);if(I)v.remember?Le.setItem("credentials",v):Le.removeItem("credentials"),r(O.actions.loginRequested(v));else{const S=await I.json();r(O.actions.unbusy("Login")),e.error({message:"Неверный логин/пароль"})}}catch{r(O.actions.unbusy("Login")),e.error({message:"Не удалось авторизоваться"})}await Te(1e3),d(!1)};return s.jsx(rr,{spinning:p||n.busy.length!==0,children:s.jsx(Ee,{type:"flex",justify:"center",align:"middle",style:{minHeight:"100vh"},children:s.jsx(Q,{title:"Авторизация",actions:[s.jsx(wt,{checked:u,onChange:h=>l(h.target.checked),children:"Запомнить"}),s.jsx(Ct,{to:le().forgot({}),children:"Забыли пароль ?"}),s.jsx(q,{type:"primary",htmlType:"submit",className:"login-form-button",onClick:y,loading:p||n.busy.length!==0,icon:s.jsx(Cn,{}),children:"Логин"})],children:s.jsxs(Ie,{className:"login-form",style:{minWidth:"400px"},labelCol:{span:4},wrapperCol:{span:20},children:[s.jsxs(Ie.Item,{label:s.jsx(nr,{}),children:[t,s.jsx(gt,{value:o,onChange:h=>a(h.target.value),prefix:s.jsx(Ps,{type:"user",style:{color:"rgba(0,0,0,.25)"}}),placeholder:"Username"})]}),s.jsx(Ie.Item,{label:s.jsx(Rn,{}),children:s.jsx(gt.Password,{value:i,onChange:h=>c(h.target.value),prefix:s.jsx(Ps,{type:"lock",style:{color:"rgba(0,0,0,.25)"}}),type:"password",placeholder:"Password"})})]})})})})},li=()=>s.jsx(Ee,{type:"flex",justify:"center",align:"middle",style:{minHeight:"100vh"},children:s.jsx(Q,{title:"Восстановление пароля",children:s.jsx(En,{status:"info",title:"Для восстановления доступа обратитесь к администратору admin@rengin.ru tel: +7 9777 666 076) ",subTitle:"Это программное обеспечение на этапе разработки",extra:[s.jsx(Ct,{to:le().login({}),children:s.jsx(q,{type:"primary",children:"Вернуться"},"console")})]})})}),ci=e=>({route:{routes:[...e==="руководитель"?[{path:"/app/in/dashboard",name:"Дашборд",icon:s.jsx(kn,{})}]:[],{path:"/app/in/issues",name:"Заявки",icon:s.jsx(Tn,{})},{path:"/app/in/contracts",name:"Договоры",icon:s.jsx(Nn,{})},{path:"/app/in/subs",name:"Подписки",icon:s.jsx(Dn,{})},{path:"/app/in/dicts",name:"Справочники",icon:s.jsx(nt,{}),routes:[{path:"/app/in/brands",name:"Заказчики",icon:s.jsx(nt,{})},{path:"/app/in/legals",name:"Юр Лица",icon:s.jsx(nt,{})},{path:"/app/in/sites",name:"Объекты",icon:s.jsx(nt,{})},{path:"/app/in/import-sites",name:"Импорт",icon:s.jsx(Pn,{})}]},{path:"/app/in/users",name:"Контакты",icon:s.jsx(nr,{})}]},appList:[]}),Ye=B,di=()=>Ye(e=>e),_e=()=>({currentUser:Ye(gs)}),ui=()=>s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"150",height:"70",fill:"none",viewBox:"0 0 279 70",children:[s.jsx("mask",{id:"a",width:"233",height:"70",x:"23",y:"0",maskUnits:"userSpaceOnUse",style:{maskType:"luminance"},children:s.jsx("path",{fill:"#fff",d:"M256 0H23v70h233V0Z"})}),s.jsxs("g",{mask:"url(#a)",children:[s.jsx("path",{fill:"url(#b)",d:"M85.231 68.19V31.199l-10.447-3.115-2.176.985V3.962L62.352 0 39.974 10.33v34.29l-10.089 3.093V68.19H23v1.672h8.654V48.927l8.344-2.566v23.502h8.942V47.049l-7.197-2.428V11.384l19.772-9.14v31.817l-10.95 4.948v30.854h8.296V45.125l12.002-4.123v28.86h9.73V40.957l-7.985-1.81V30.9l2.32-1.054 8.558 2.543v37.474h7.1V68.19h-5.355Zm-38.06-19.95v19.928H41.72V46.384l5.45 1.856Zm23.692-9.025-13.747 4.718v24.235h-4.805V40.062l18.552-8.36v7.513Zm0-9.369-7.579 3.413V2.153l7.579 2.932v24.761Zm7.985 12.438v25.907h-6.24V40.864l6.24 1.42Z"}),s.jsx("path",{fill:"#fff",d:"M150.876 23.755v16.424h4.411V17.011h-4.191l-12.983 16.425V17.01h-4.411v23.17h4.192l12.982-16.424Zm28.717-6.744h-20.427v3.627h7.977v19.541h4.442V20.638h8.008V17.01Zm37.79-1.558c4.16 0 6.287-1.709 6.318-4.796h-3.096c-.063 1.649-1.252 2.548-3.222 2.548-2.003 0-3.098-.9-3.129-2.548h-3.128c.031 3.057 2.096 4.796 6.257 4.796Zm-6.32 17.983V17.01h-4.411v23.17h4.193l12.981-16.424V40.18h4.411V17.011h-4.161l-13.013 16.425Zm26.558-16.425-.343 9.591c-.25 6.534-1.127 9.95-4.066 9.95-.376 0-.689-.03-1.033-.12l-.313 3.747c.938.21 1.689.33 2.44.33 5.224 0 6.632-4.945 6.944-14.057l.219-5.784h9.541v19.511h4.411V17.011h-17.8ZM111.523 55.585v-8.752h-2.346v12.348h2.221l6.914-8.752v8.752h2.346V46.833h-2.221l-6.914 8.752Zm21.804-3.657h-6.663v-5.095h-2.378v12.348h2.378v-5.305h6.663v5.305h2.377V46.833h-2.377v5.095Zm22.961-5.095h-2.534l-3.19 5.185h-2.221v-5.185h-2.316v5.185h-2.283l-3.128-5.185h-2.534l3.754 5.904-4.036 6.444h2.753l3.253-5.215h2.221v5.215h2.316v-5.215h2.221l3.222 5.215h2.753l-4.005-6.414 3.754-5.934Zm4.317 8.752v-8.752h-2.346v12.348h2.221l6.913-8.752v8.752h2.346V46.833h-2.221l-6.913 8.752Zm21.773-3.657h-6.664v-5.095h-2.377v12.348h2.377v-5.305h6.664v5.305h2.408V46.833h-2.408v5.095Zm8.383 3.657v-8.752h-2.377v12.348h2.221l6.913-8.752v8.752h2.377V46.833h-2.221l-6.913 8.752Zm18.019-8.752h-5.287v12.318h2.377v-3.566h2.91c3.379 0 5.474-1.679 5.474-4.376 0-2.698-2.095-4.376-5.474-4.376Zm-.094 6.834h-2.785V48.78h2.785c2.096 0 3.19.9 3.19 2.458-.031 1.528-1.094 2.428-3.19 2.428Zm10.197 1.918v-8.752h-2.346v12.348h2.221l6.915-8.752v8.752h2.346V46.833h-2.221l-6.915 8.752Zm21.805-3.657h-6.663v-5.095h-2.377v12.348h2.377v-5.305h6.663v5.305h2.377V46.833h-2.377v5.095Zm6.006 7.253h2.346v-10.4h6.381v-1.948h-8.727v12.348ZM113.682 33.496h5.443c6.35 0 10.292-3.148 10.292-8.243 0-5.125-3.942-8.242-10.292-8.242h-7.758l-2.19 3.627h9.76c3.942 0 5.975 1.678 5.975 4.585 0 2.908-2.033 4.586-5.975 4.586h-9.76v10.34h4.505v-6.653Zm85.244-12.888 2.19-3.597h-17.644v3.597h15.454Zm-10.949 9.561h11.668v-3.537h-16.173v13.547h18.145v-3.626h-13.64v-6.384Z"})]}),s.jsx("defs",{children:s.jsxs("linearGradient",{id:"b",x1:"255.421",x2:"216.902",y1:"69.863",y2:"-58.285",gradientUnits:"userSpaceOnUse",children:[s.jsx("stop",{"stop-color":"#2AF598"}),s.jsx("stop",{offset:"1","stop-color":"#009EFD"})]})})]}),pi=e=>{const t=qr(),r=oe(),n=async()=>{t(O.actions.logout(void 0)),r.replace(le().login({})),window.location.reload()};return s.jsx(ar,{trigger:["click"],...e,menu:{items:[{onClick:()=>{n()},danger:!0,key:"logout",icon:s.jsx(An,{}),label:"Выйти"}]},children:e.children})},fe=({proLayout:e,children:t,hidePageContainer:r,...n})=>{const o=Gr(),a={fixSiderbar:!0,layout:"mix",splitMenus:!1},{currentUser:i}=_e(),c=Ye(Ge.selectAvatar(i.userId)),l=oe().location.pathname;return s.jsx(On,{breakpoint:!1,loading:o.busy.length!==0,collapsed:!1,bgLayoutImgList:[{src:"https://img.alicdn.com/imgextra/i2/O1CN01O4etvp1DvpFLKfuWq_!!6000000000279-2-tps-609-606.png",left:85,bottom:100,height:"303px"},{src:"https://img.alicdn.com/imgextra/i2/O1CN01O4etvp1DvpFLKfuWq_!!6000000000279-2-tps-609-606.png",bottom:-68,right:-45,height:"303px"},{src:"https://img.alicdn.com/imgextra/i3/O1CN018NxReL1shX85Yz6Cx_!!6000000005798-2-tps-884-496.png",bottom:0,left:0,width:"331px"}],...ci(i.role),location:{pathname:l},logo:s.jsx(ui,{}),title:s.jsx("div",{children:"Rengin"}),avatarProps:{icon:s.jsx(Wt,{}),src:c,size:"small",title:s.jsxs(H.Link,{children:[s.jsx(H.Text,{type:"success",children:i.role})," ",i.email]}),render:(p,d)=>s.jsx(pi,{...p,children:s.jsxs(ee,{children:[d,s.jsx("a",{href:"#",children:s.jsx(Ln,{})})]})})},menuFooterRender:p=>{if(!(p!=null&&p.collapsed))return s.jsx("div",{style:{textAlign:"center",paddingBlockStart:12},children:s.jsx("div",{children:"© 2023 rengindesk.ru"})})},collapsedButtonRender:()=>null,onMenuHeaderClick:p=>{console.log(p);debugger},menuItemRender:(p,d)=>s.jsx(Ct,{to:p.path,children:d}),...a,...e,children:r?t:s.jsx(Un,{...n,children:t})})},mi=()=>{const e=B(hs.selectBootstrap);return s.jsxs(fe,{children:[s.jsxs(Ee,{gutter:[16,16],style:{marginBottom:"16px",marginTop:"16px"},children:[s.jsx(at,{span:12,children:s.jsx(Q,{children:s.jsx(ot,{title:"Пользователей",value:e.users.length,precision:0,valueStyle:{color:"#3f8600"},prefix:s.jsx(ks,{}),suffix:""})})}),s.jsx(at,{span:12,children:s.jsx(Q,{children:s.jsx(ot,{title:"Объекты",value:e.sites.length,precision:0,valueStyle:{color:"#cf1322"},prefix:s.jsx(Wt,{}),suffix:"%"})})})]}),s.jsxs(Ee,{gutter:[16,16],children:[s.jsx(at,{span:12,children:s.jsx(Q,{bordered:!1,children:s.jsx(ot,{title:"Договора",value:e.contracts.length,precision:0,valueStyle:{color:"#3f8600"},prefix:s.jsx(ks,{}),suffix:""})})}),s.jsx(at,{span:12,children:s.jsx(Q,{bordered:!1,children:s.jsx(ot,{title:"Заявки",value:e.issues.length,precision:0,valueStyle:{color:"#cf1322"},prefix:s.jsx(Wt,{}),suffix:"%"})})})]})]})},qe=e=>({view:()=>"/app/in/"+e.collection,create:(t={})=>["issue","user","brand"].includes(e.rid)?"/app/in/"+e.collection+"/#create":"/app/in/"+e.collection+"/create?"+new URLSearchParams(t).toString(),edit:t=>["issue","user","brand"].includes(e.rid)?"/app/in/"+e.collection+"/#"+t:"/app/in/"+e.collection+"/"+t}),hi={ClickToEdit:e=>{const t=e.colDef.resource,r=qe(t).edit(e.value);return s.jsx(Ct,{to:r,children:s.jsx(Bn,{})})}},ve=()=>Ye(yt),ne=(e,t=void 0)=>{e.resourceName,ve();const r=Ye(u=>u),n={checkboxSelection:!0,headerCheckboxSelectionFilteredOnly:!0,headerCheckboxSelection:!0,width:30,resizable:!1},a={clickToEditCol:{headerName:"",field:e.idProp,sourceResourceName:e.resourceName,cellRenderer:t?void 0:hi.ClickToEdit,width:120,fieldName:e.idProp,resizable:!1,resource:e},checkboxCol:n},i=u=>{const l=e.properties[u],p={editable:!1,headerName:l.headerName,resizable:!0,sortable:!0,field:u,fieldName:u,resource:e,filter:!0,width:120};if(l.type==="date"){let d=function(y){const h=y.data[u];var v=new Date(h);if(h)return`${v.getFullYear()}/${(v.getMonth()+1).toString().padStart(2,"0")}/${v.getDate().toString().padStart(2,"0")}`};p.valueFormatter=d,p.width=100}if(Ve(l)){const d=xt(l.linkedResourceName),y={};return l.required&&(y["grid-cell-required"]=h=>h.data[h.colDef.field]===void 0),{...p,cellClassRules:y,valueGetter:h=>{const v=h.data[h.colDef.field];try{const f=d.selectById(v)(r);return d.getItemName(f)}catch(f){return console.error(f),console.error(e.rid,h,h.colDef.field),v?"Удалён "+v:"Не указан"}}}}return p},c=e.fieldsList.filter((u,l)=>l!==0&&u.type!=="array"&&u.colDef!==!1).map(u=>{const l=i(u.name),p=u.colDef?{...l,...u.colDef}:l;return a[u.name]=p,p});return[[a.clickToEditCol,...c],a]};const fs={selectAll:"(Выделить все)",selectAllSearchResults:"(Выделить все результаты поиска)",searchOoo:"Поиск...",blanks:"(Пусто)",noMatches:"Нет совпадений",filterOoo:"Фильтрация...",equals:"Равно",notEqual:"Не равно",empty:"Выберите один",lessThan:"Меньше, чем",greaterThan:"Больше, чем",lessThanOrEqual:"Меньше или равно",greaterThanOrEqual:"Больше или равно",inRange:"В промежутке",inRangeStart:"от",inRangeEnd:"до",contains:"Содержит",notContains:"Не содержит",startsWith:"Начинается с",endsWith:"Кончается на",dateFormatOoo:"dd-mm-yyyy",andCondition:"И",orCondition:"ИЛИ",applyFilter:"Применить",resetFilter:"Сбросить",clearFilter:"Очистить",cancelFilter:"Отменить",textFilter:"Текстовый фильтр",numberFilter:"Числовой фильтр",dateFilter:"Фильтр по дате",setFilter:"Выбрать фильтр",columns:"Столбцы",filters:"Фильтры",pivotMode:"Режим сводной таблицы",groups:"Группы строк",rowGroupColumnsEmptyMessage:"Перетащите сюда для группировки по строкам",values:"Значения",valueColumnsEmptyMessage:"Перетащите сюда для агрегации",pivots:"Заголовки столбцов",pivotColumnsEmptyMessage:"Перетащите сюда для задания заголовков столбцам",group:"Группа",loadingOoo:"Загрузка...",noRowsToShow:"Нет данных",enabled:"Включено",pinColumn:"Закрепить столбец",pinLeft:"Закрепить слева",pinRight:"Закрепить справа",noPin:"Не закреплять",valueAggregation:"Агрегация по значению",autosizeThiscolumn:"Автоматически задавать размер этого столбца",autosizeAllColumns:"Автоматически задавать размер всем столбцам",groupBy:"Группировать по",ungroupBy:"Разгруппировать по",resetColumns:"Сбросить столбцы",expandAll:"Развернуть все",collapseAll:"Свернуть все",copy:"Копировать",ctrlC:"Ctrl+C",copyWithHeaders:"Копировать с заголовками",paste:"Вставить",ctrlV:"Ctrl+V",export:"Экспорт",csvExport:"Экспорт в CSV (.csv)",excelExport:"Экспорт в Excel (.xlsx)",excelXmlExport:"Экспорт в XML (.xml)",sum:"Сумма",min:"Минимум",max:"Максимум",none:"Пусто",count:"Количество",avg:"Среднее значение",filteredRows:"Отфильтровано",selectedRows:"Выбрано",totalRows:"Всего строк",totalAndFilteredRows:"Строки",more:"многих",to:"из",of:"по",page:"Страница",nextPage:"Следующая страница",lastPage:"Последняя страница",firstPage:"Первая страница",previousPage:"Предыдущая страница",pivotChartAndPivotMode:"Сводная диаграмма & режим сведения",pivotChart:"Сводная диаграмма",chartRange:"Диапазон диаграммы",columnChart:"Столбиковая диаграмма",groupedColumn:"Сгруппированная",stackedColumn:"Сложенная",normalizedColumn:"100% Сложенная",barChart:"Панель",groupedBar:"Сгруппированная",stackedBar:"Сложенная",normalizedBar:"100% Сложенная",pieChart:"Круговая диаграмма",pie:"Круговая диаграмма",doughnut:"Кольцевая диаграмма",line:"Линия",xyChart:"X Y (Разброс)",scatter:"Диаграмма рассеяния",bubble:"Пузырьковая диаграмма",areaChart:"Область",area:"Диаграмма с областями",stackedArea:"Сложенная",normalizedArea:"100% Сложенная",histogramChart:"Гистограмма",pivotChartTitle:"Сводная диаграмма",rangeChartTitle:"График диапазона",settings:"Настройки",data:"Данные",format:"Формат",categories:"Категории",defaultCategory:"(Пусто)",series:"Серии",xyValues:"X Y Значения",paired:"Парный режим",axis:"Ось",navigator:"Навигация",color:"Цвет",thickness:"Толщина",xType:"X Тип",automatic:"Автоматически",category:"Категория",number:"Число",time:"Время",xRotation:"X Поворот",yRotation:"Y Поворот",ticks:"Отметки",width:"Ширина",height:"Высота",length:"Длина",padding:"Внутренний отступ",spacing:"Отступ",chart:"Диаграмма",title:"Заголовок",titlePlaceholder:"Заголовок диаграммы - двойной щелчок для редактирования",background:"Фон",font:"Шрифт",top:"Верх",right:"Право",bottom:"Низ",left:"Лево",labels:"Метки",size:"Размер",minSize:"Минимальный размер",maxSize:"Максимальный размер",legend:"Легенда",position:"Позиция",markerSize:"Размер маркера",markerStroke:"Обводка маркера",markerPadding:"Внутренний отступ маркера",itemSpacing:"Расстояние между предметами",itemPaddingX:"Внутренний отступ предмета по X",itemPaddingY:"Внутренний отступ предмета по Y",layoutHorizontalSpacing:"Горизонтальный отступ",layoutVerticalSpacing:"Вертикальный отступ",strokeWidth:"Ширина обводки",offset:"Смещение",offsets:"Смещения",tooltips:"Всплывающие подсказки",callout:"Вызов",markers:"Маркеры",shadow:"Тень",blur:"Размытие",xOffset:"Смещение по X",yOffset:"Смещение по Y",lineWidth:"Ширина линии",normal:"Нормальный",bold:"Жирный",italic:"Наклоненный",boldItalic:"Жирный наклоненный",predefined:"Предопределенный",fillOpacity:"Непрозрачность заливки",strokeOpacity:"Непрозрачность линии",histogramBinCount:"Количество сегментов",columnGroup:"Столбец",barGroup:"Панель",pieGroup:"Круговая",lineGroup:"Линейная",scatterGroup:"X Y (Разброс)",areaGroup:"Зональная",histogramGroup:"Гистограмма",groupedColumnTooltip:"Сгруппированная",stackedColumnTooltip:"Сложенная",normalizedColumnTooltip:"100% Сложенная",groupedBarTooltip:"Сгруппированная",stackedBarTooltip:"Сложенная",normalizedBarTooltip:"100% Сложенная",pieTooltip:"Круговая",doughnutTooltip:"Кольцевая",lineTooltip:"Линейная",groupedAreaTooltip:"Зональная",stackedAreaTooltip:"Сложенная",normalizedAreaTooltip:"100% Сложенная",scatterTooltip:"Рассеяния",bubbleTooltip:"Пузырьковая",histogramTooltip:"Гистограмма",noDataToChart:"Нет данных для представления в виде диаграммы.",pivotChartRequiresPivotMode:"Для сводной диаграммы необходимо включить режим сводной диаграммы.",chartSettingsToolbarTooltip:"Меню",chartLinkToolbarTooltip:"Связать с сеткой",chartUnlinkToolbarTooltip:"Не связывать с сеткой",chartDownloadToolbarTooltip:"Загрузить диаграмму",ariaHidden:"скрытый",ariaVisible:"видимый",ariaChecked:"проверенный",ariaUnchecked:"непроверенный",ariaIndeterminate:"неопределенный",ariaColumnSelectAll:"Переключить на выделение всех столбцов",ariaInputEditor:"Редактор ввода",ariaDateFilterInput:"Ввод фильтра даты",ariaFilterInput:"Ввод фильтра",ariaFilterColumnsInput:"Ввод фильтра столбцов",ariaFilterValue:"Значение фильтра",ariaFilterFromValue:"Фильтровать от значения",ariaFilterToValue:"Фильтровать до значения",ariaFilteringOperator:"Оператор фильтрации",ariaColumnToggleVisibility:"переключить видимость столбца",ariaColumnGroupToggleVisibility:"переключить видимость группы столбцов",ariaRowSelect:"Нажмите ПРОБЕЛ для выделения данной строки",ariaRowDeselect:"Нажмите ПРОБЕЛ для снятия выделения данной строки",ariaRowToggleSelection:"Нажмите ПРОБЕЛ, чтобы переключить выделение строки",ariaRowSelectAll:"Нажмите ПРОБЕЛ, чтобы переключить выделение всех строк",ariaSearch:"Поиск",ariaSearchFilterValues:"Поиск значений по фильтру"};const gi=or.forwardRef(({columnDefs:e,fullHeight:t,...r},n)=>{const o=C.useMemo(()=>fs,[]);return console.log(e),s.jsxs(s.Fragment,{children:[" ",s.jsx("div",{className:"ag-theme-alpine",style:{height:t?"calc(100vh - 144px)":"calc(100vh - 244px)",width:"100%"},children:s.jsx(ss.AgGridReact,{ref:n,localeText:o,columnDefs:e,defaultColDef:{resizable:!0,sortable:!0},enableRangeSelection:!0,allowContextMenuWithControlKey:!0,...r})})]})}),$r=()=>{const{pathname:e}=ir(),t=kr.find(a=>e.includes(a.collection));if(!t)throw new Error("Resource for page "+e+" is not found");const r=e.split("/").pop(),n=B(t.selectById(r)),o=e.endsWith(t.collection)?"LIST":e.endsWith("create")?"CREATE":"EDIT";return o==="EDIT"?{resource:t,verb:o,item:n,id:r}:{resource:t,verb:o}},fi=({resource:e,defaultProps:t,href:r,onCreate:n})=>{const o=$r();let a=r||qe(o.resource).create();e&&(a=qe(e).create(t));const i=oe(),c=u=>{i.push(a)};return s.jsx(q,{type:"primary",icon:s.jsx(rs,{}),onClick:n||c})},ys=({resource:e,id:t,onDeleted:r,onClick:n,...o})=>{oe();const a=()=>{r&&r(t)};return s.jsx(Fn,{title:"Удаление",description:"Вы уверениы что хотите удалить записи?",okText:"Удалить",cancelText:"Отмена",onConfirm:a,children:s.jsx(q,{danger:!0,icon:s.jsx(lr,{}),...o,children:"Удалить"})})},Qe=({onCancel:e})=>s.jsx(q,{icon:s.jsx(Mn,{}),onClick:e,children:"Отмена"}),et=()=>{const{currentUser:e}=_e();return e.role},yi=[{label:"Сохранить",icon:s.jsx(Gn,{}),key:"save"},{label:"Назначенные мне",icon:s.jsx($n,{}),key:"hide"},{type:"divider"},{label:"Удалить записи",icon:s.jsx(lr,{}),key:"delete",danger:!0}],ce=({title:e,gridRef:t,bottomBar:r,toolbar:n,columnDefs:o,resource:a,rowData:i,createItemProps:c,...u})=>{const l=Se(),[p,d]=C.useState(!1),[y,h]=ne(a,p?"multiple":void 0),v=o||y,[f,...I]=v,w=[p?h.checkboxCol:f,...I],T=B(a.selectList),P=i||T,[m,b]=C.useState(""),[g,j]=C.useState([]),R=U=>{b(U.target.value)},k=U=>{U==="delete"&&(d(!0),j([]))},te=()=>{const U=a.actions.removedBatch(g);l(U),j([]),d(!1)},z=C.useRef(null),Z=()=>{const ae=z.current.api.getSelectedRows().map(ie=>ie[a.idProp]);j(ae)},De=()=>s.jsxs(s.Fragment,{children:[s.jsx(ys,{disabled:g.length===0,onDeleted:te}),s.jsx(Qe,{onCancel:()=>d(!1)})]}),we=et(),D=()=>we==="сметчик"?s.jsx(H.Text,{children:"Вы можете редактировать сметы"}):s.jsxs(s.Fragment,{children:[s.jsx(fi,{resource:a,defaultProps:c}),s.jsx(ar,{menu:{items:yi,onClick:U=>{k(U.key)}},children:s.jsx(q,{icon:s.jsx(qn,{}),type:"text"})})]}),K=C.useCallback(()=>{z.current.api.exportDataAsExcel()},[]);return s.jsxs(s.Fragment,{children:[" ",s.jsxs("div",{style:{height:"48px",boxShadow:"0 1px 4px rgba(0,21,41,.12)",padding:"0 10px 0 10px",width:"100%",display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center"},children:[s.jsx("h3",{style:{whiteSpace:"nowrap"},children:e}),n,s.jsx("div",{style:{display:"flex"},children:s.jsxs(ee,{children:[s.jsx(gt,{style:{maxWidth:"250px",marginRight:"16px",lineHeight:"unset"},addonBefore:s.jsx(Vn,{}),placeholder:"Быстрый поиск",allowClear:!0,value:m,onChange:R}),p?De():D()]})})]}),s.jsx(gi,{onSelectionChanged:Z,rowSelection:p?"multiple":void 0,...u,columnDefs:w,rowData:P,resource:a,quickFilterText:m,ref:z}),s.jsxs("div",{style:{paddingTop:"4px",display:"flex",justifyContent:"space-between"},children:[s.jsx(ee,{children:s.jsxs(H.Text,{children:["Всего записей: ",P.length]})}),s.jsxs(ee,{children:[r&&z.current&&r({ag:z.current}),s.jsx(q,{icon:s.jsx(ns,{}),onClick:K,children:"Скачать .xlsx"})]})]})]})},_r=()=>B(e=>e),xi=e=>{const t=[];return Object.values(e).filter(r=>r.type==="array").forEach(r=>t[r.name]=[]),t},xs=(e,t)=>{oe().location.state;const n=Se(),o=e.resource,[a]=C.useState({[o.idProp]:me(),...xi(o.properties)}),i=_r(),c=B(e.resource.selectList),u=t==="create"?"create":"edit",l=t==="create"?a[o.idProp]:typeof t=="string"?t:t[o.idProp],p=t==="create"?a:typeof t=="string"?c.find(S=>S[o.idProp]===l):t,[d,y]=C.useState(p),h=S=>w=>{y(e.updateProperty(S)({item:d,value:w,state:i,mode:u}))},v=e.getAllErrors(d)(i),f=e.getAllParams(d)(i);return{editor:e,rules:e.rules,resource:e.resource,hasChanges:JSON.stringify(p)!==JSON.stringify(d),isValid:_n(v),item:d,params:f,errors:v,mode:u,remove:()=>{n(e.resource.actions.removed(l))},save:()=>{var S,w;u==="create"?n((S=e.resource.actions)==null?void 0:S.added(d)):JSON.stringify(p)!==JSON.stringify(d)&&n((w=e.resource.actions)==null?void 0:w.patched(d))},updateItemProperty:h,validateProps:()=>{},getRenFieldProps:S=>({mode:u,editor:e,rules:e.rules[S],value:d[S],property:e.resource.properties[S],updateItemProperty:h(S),error:v[S],params:f[S]})}},tt=e=>C.useContext(kt),bi=(e,t)=>tt().getRenFieldProps(t||e),kt=C.createContext({}),Hr={labelCol:{span:6},wrapperCol:{span:18}},Ii={labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:14}}},bs=({children:e})=>{const t=tt();console.log("editor IN MODAL ",t);const r=oe(),n=t.resource.getItemName(t.item),o=()=>{t.save(),i()},a=async()=>{i(),await Te(100),t.remove()},i=()=>{r.goBack()},c=()=>{t.mode=="edit"?o():r.goBack()};return s.jsx(Rt,{width:"80%",style:{top:"20px"},title:n,open:!0,footer:[s.jsx(ys,{onDeleted:a}),s.jsx(Qe,{onCancel:i,disabled:!t.hasChanges}),s.jsx(q,{type:"primary",disabled:!t.hasChanges,icon:s.jsx(Et,{}),onClick:o,children:"Сохранить"})],onCancel:c,children:s.jsx(Ie,{...Ii,style:{maxWidth:800},...Hr,layout:"horizontal",children:e})})},{Text:ji,Link:xl}=H,X=({meta:e,disabled:t})=>{const r=bi(e.name),n=_r(),{value:o,updateItemProperty:a,property:i,error:c,mode:u,params:l,editor:p}=r,d={disabled:(u==="edit"?i.immutable:!1)||t},y=()=>{if(i.immutable&&u==="edit"){let h=o;if(Ve(i)){const v=xt(i.linkedResourceName),f=v.selectById(o)(n);f&&(h=v.getItemName(f))}return s.jsx(ji,{type:"success",children:h})}return Ve(i)?s.jsx(zt,{value:o,optionFilterProp:"label",showSearch:!0,placeholder:i.headerName,disabled:t,onChange:h=>{console.log("Select onChange",h),a(h)},style:{minWidth:"200px"},options:l.options,dropdownRender:h=>s.jsxs(s.Fragment,{children:[h,s.jsx(Hn,{style:{margin:"8px 0"}}),s.jsx(ee,{style:{padding:"0 8px 4px"},children:s.jsx(q,{type:"text",icon:s.jsx(rs,{}),children:"Добавить"})})]}),...d}):i.type==="enum"?s.jsx(zt,{value:o,optionFilterProp:"label",showSearch:!0,placeholder:i.headerName,onChange:h=>{console.log("Select onChange",h),a(h)},style:{minWidth:"200px"},options:l.options,dropdownRender:h=>s.jsx(s.Fragment,{children:h}),...d}):r.property.type==="boolean"?s.jsx(wt,{checked:o,onChange:h=>{console.log("DatePicker onChange",h),a(h.target.checked)},...d}):r.property.type==="date"?s.jsx(as,{locale:cr,value:o===void 0?void 0:V(o),onChange:h=>{a(h&&h.toDate().toISOString())},...d}):r.property.type==="text"?s.jsx(Wn,{value:o,onBlur:h=>{a(h.target.value)},...d}):s.jsx(gt,{value:r.value,onBlur:h=>{a(h.target.value)},onChange:h=>{a(h.target.value)},...d})};return c?s.jsx(Ie.Item,{label:i.headerName,validateStatus:"error",hasFeedback:!0,help:c,required:i.required,children:y()}):s.jsxs(Ie.Item,{label:i.headerName,required:i.required,children:[y(),s.jsx("span",{})]})},Wr=({list:e})=>s.jsx(s.Fragment,{children:e.map(t=>s.jsx(X,{meta:t}))}),Is=e=>{const t=[];return e.forEach(r=>t.push({value:r,label:r})),t},Ot=(e,t)=>{const r=e.idKey,n={};e.fieldsList.forEach(u=>{n[u.name]={getParams:({value:l,item:p,property:d,state:y})=>{const h=d;if(Ve(h)){const v=$e[h.linkedResourceName];return{options:v.asOptions(v.selectAll(y))}}return za(h)?{options:Is(h.enum)}:{}},getUpdate:({value:l,item:p,property:d,state:y})=>({...p,[d.name]:l}),getErrors:({value:l,item:p,property:d,state:y})=>{if(d.required&&l===void 0)return"Не может быть пустым";if(d.unique&&e.selectList(y).find(f=>f[d.name]===l&&p[r]!==f[r]))return"Значение должно быть уникальным"}}});const o=Oe(n,t);return{resource:e,rules:o,getAllErrors:u=>l=>{const p={};return Object.keys(o).forEach(d=>p[d]=o[d].getErrors({value:u[d],item:u,property:e.properties[d],state:l,propertyName:d})),p},getAllParams:u=>l=>{const p={};return Object.keys(o).forEach(d=>p[d]=o[d].getParams({value:u[d],item:u,property:e.properties[d],state:l,propertyName:d})),p},updateProperty:u=>({value:l,item:p,state:d,mode:y})=>o[u].getUpdate({propertyName:u,property:e.fields[u],item:p,state:d,value:l})}},zr={getErrors:({value:e,item:t,state:r})=>{const n=$.selectById(e)(r);if(n){const o=J.selectById(n.brandId)(r);if(J.selectById(t.brandId)(r)&&o&&n.brandId!==o.brandId)return"Назначен ответственный инженер от заказчика "+o.brandName}},getParams:({item:e,state:t})=>{var r=$.selectEq({role:"ответственный инженер"})(t);return e.brandId&&(r=r.filter(n=>n.brandId===e.brandId)),{options:$.asOptions(r),addNewItemDefaults:{}}},getUpdate:({item:e,value:t,state:r})=>{const n=$.selectById(t)(r),o=St(e);return!e.brandId&&n&&n.brandId&&(o.brandId=n.brandId),o.clientsEngineerUserId=t,o}},js={getParams:({item:e,state:t})=>{var r=$.selectAll(t).filter(n=>n.role==="руководитель"||n.role==="менеджер");return{options:$.asOptions(r)}}},Zr={getParams:({item:e,state:t})=>{var r=$.selectAll(t).filter(n=>n.role==="техник");return{options:$.asOptions(r)}}};Ot(F,{brandId:{getUpdate:({value:e,item:t,property:r,state:n})=>({...e,brandId:e,siteId:void 0,legalId:void 0,subId:void 0})},managerUserId:js,clientsEngineerUserId:zr,techUserId:Zr});const vi=Ot(J,{managerUserId:js}),Si=({id:e})=>{const t=xs(vi,e),r=J,{removed:n,...o}=J.properties,a=ve(),i=a.sites.filter(d=>d.brandId==e);ne(F);const c=r.getItemName(t.item),u=a.legals.filter(d=>d.brandId==e);ne(G);const l=a.contracts.filter(d=>d.brandId===e),p=s.jsxs(xe,{tabs:{type:"card"},actions:[null,s.jsx(zn,{})],children:[s.jsx(xe.TabPane,{tab:"Объекты",children:s.jsx(ce,{createItemProps:{brandId:e},title:c,resource:F,rowData:i})},"tab1"),s.jsx(xe.TabPane,{tab:"Юр. Лица",children:s.jsx(ce,{createItemProps:{brandId:e},title:c,resource:G,rowData:u})},"tab2"),s.jsx(xe.TabPane,{tab:"Договоры",children:s.jsx(ce,{createItemProps:{brandId:e},title:c,resource:_,rowData:l})},"tab3")]});return s.jsx(kt.Provider,{value:t,children:s.jsxs(bs,{children:[s.jsx(Wr,{list:Array.from(Object.values(o))}),p]})})},wi=()=>{const e=ve(),t=e.brands,[r]=ne(J),n=window.location.hash===""?void 0:window.location.hash.slice(1),o=oe(),a=()=>{o.push(le().brandsList({brandID:"create"}))};return s.jsx(fe,{hidePageContainer:!0,proLayout:{contentStyle:{padding:"0px"}},children:s.jsxs("div",{children:[n?s.jsx(Si,{id:n}):null,s.jsx(ce,{fullHeight:!0,title:J.langRU.plural,resource:J,rowData:t,onCreateClick:a,cols:[...r,{colId:"sitesCalc",field:"brandId",headerName:"Объекты",editable:!1,valueGetter:i=>e.sites.filter(c=>c.brandId===i.data.brandId).length},{colId:"legalsCals",field:"brandId",headerName:"Юр. лица",editable:!1,valueGetter:i=>e.legals.filter(c=>c.brandId===i.data.brandId).length},{colId:"issuesCalc",field:"brandId",headerName:"Всего заявок",editable:!1,valueGetter:i=>e.issues.filter(c=>c.brandId===i.data.brandId).length}]})]})})},vs=({submitter:e,...t})=>s.jsx(Me,{submitter:{searchConfig:{resetText:"Отмена",submitText:"Сохранить"},resetButtonProps:{},submitButtonProps:{},render:(r,n)=>(console.log("render rfrom prps",r),s.jsx(Ee,{style:{display:"flex",justifyContent:"flex-end"},children:s.jsx(ee,{children:n})})),...e},...t}),Ci=e=>{const{resource:t,renderForm:r,item:n,renderItemInfo:o,verb:a,renderList:i,id:c}=e,u=C.useRef(),l=t.idProp,p=n,d=Se(),y=oe(),[h,v]=C.useState(p),f=async m=>{const b={...p,...m,[l]:c},g=t.actions.patched(b,p);console.log("Submit",m,g),y.goBack(),g&&d(g)},I=t.getItemName(h),S=()=>{var m;(m=u.current)==null||m.submit()},w=()=>{d(t.actions.removed(c)),P()},T={labelCol:{span:6},wrapperCol:{span:18}},P=()=>y.goBack();return s.jsxs(fe,{proLayout:{extra:[s.jsx(Qe,{onCancel:P}),s.jsx(ys,{resource:t,id:c,onDeleted:w}),s.jsx(q,{type:"primary",icon:s.jsx(Et,{}),onClick:S,children:"Сохранить"})],title:"Rengin"},onBack:P,title:s.jsx(os,{items:[{href:qe(t).view(),title:t.langRU.plural},{title:I}]}),children:[s.jsx(vs,{layout:"horizontal",...T,formRef:u,readonly:!1,initialValues:p,onValuesChange:(m,b)=>{console.log(b),v(b)},onFinish:async m=>{f(m)},onReset:P,submitter:{render:m=>null},children:r({resource:t,item:h,id:c,verb:a,renderItemInfo:o})}),o&&o({...e,item:n})]})};function Kr(){const{search:e}=ir();return C.useMemo(()=>Object.fromEntries(new URLSearchParams(e)),[e])}const Ri={labelCol:{span:6},wrapperCol:{span:18}},Ei=({resource:e,renderForm:t,form:r,verb:n})=>{const o=C.useRef(),a=e.idProp,i=me(),c=Kr(),u={[a]:i,...c},[l,p]=C.useState(u),d=Se(),y=async S=>{const w={[a]:i,...S},T=e.actions.added(w);console.log("Submit",S,T),d(T)};console.log("Initial alues",u);const h=oe(),v=()=>{var S;(S=o.current)==null||S.submit()},f=()=>h.goBack(),I=s.jsx("span",{children:"Новый "+e.langRU.singular});return s.jsx(fe,{proLayout:{extra:[s.jsx(Qe,{onCancel:f}),s.jsx(q,{type:"primary",icon:s.jsx(Et,{}),onClick:v,children:"Создать"})],title:"Rengin"},onBack:f,title:s.jsx(os,{items:[{href:qe(e).view(),title:e.langRU.plural},{title:I}]}),children:s.jsx(vs,{formRef:o,layout:"horizontal",...Ri,readonly:!1,initialValues:u,onValuesChange:(S,w)=>{console.log(w),p(w)},onFinish:async S=>{console.log("onFinish",S),y(S),h.goBack()},submitter:{render:S=>null},children:t({resource:e,form:r,item:l,id:i,verb:"CREATE"})})})},Ti=({resource:e,renderList:t,verb:r,form:n})=>{const o=e.idProp,a={};return a[o],Se(),C.useState(a),s.jsx(fe,{hidePageContainer:!0,proLayout:{contentStyle:{padding:"0px"}},children:t({resource:e,verb:"LIST",form:n})})},L=(e,t,r)=>{const n=e.properties[t],o=di(),a=()=>{if(Ve(n)){const u=xt(n.linkedResourceName),l=u.selectList(o);return u.asValueEnum(l)}},i=()=>{if(Ve(n)){const u=xt(n.linkedResourceName),l=u.selectList(o);return u.asOptions(l)}},c={name:t,label:n.headerName,required:e.properties[t].required,placeholder:e.properties[t].headerName,valueEnum:a(),options:i()};return console.log(e.factoryPrefix,t,c),c},Lt=({resource:e,renderItemInfo:t,renderForm:r,renderList:n})=>{const o=$r();if(o.resource.collection===e.collection){if(o.verb==="EDIT")return s.jsx(Ci,{...o,renderForm:r,renderItemInfo:t});if(o.verb==="CREATE")return s.jsx(Ei,{...o,renderForm:r});if(o.verb==="LIST")return s.jsx(Ti,{renderList:n,...o})}return s.jsxs("div",{children:["Expected  ",e.collection," Resource, found ",o.resource.collection]})},qt=()=>{const t=ve().legals;return ne(G),s.jsx(Lt,{resource:$e.LEGALS,renderForm:({item:r,form:n,id:o,verb:a,resource:i})=>s.jsxs(s.Fragment,{children:[s.jsx(pe,{...L(G,"brandId"),rules:[{required:!0}]}),s.jsx(ue,{...L(G,"legalName"),rules:[{required:!0}]}),s.jsx(ue,{...L(G,"region"),rules:[{required:!0}]})]}),renderList:({form:r,verb:n,resource:o})=>s.jsx(ce,{fullHeight:!0,title:"Все Юр. Лица",resource:G,rowData:t})})},Gt=()=>{const e=ve(),t=F;return e.sites,ne(F),s.jsx(Lt,{resource:t,renderForm:({item:r,id:n,verb:o,resource:a})=>{const i=B(G.selectValueEnumByBrandId(r.brandId));return s.jsxs(s.Fragment,{children:[s.jsx(pe,{...L(t,"brandId"),rules:[{required:!0}]}),s.jsx(pe,{...L(t,"legalId"),valueEnum:i,rules:[{required:!0}]}),s.jsx(ue,{...L(t,"city"),rules:[{required:!0}]}),s.jsx(ue,{...L(t,"address"),rules:[{required:!0}]}),s.jsx(ue,{...L(t,"KPP")}),s.jsx(ue,{...L(t,"clientsEngineerUserId")}),s.jsx(ue,{...L(t,"managerUserId")}),s.jsx(ue,{...L(t,"techUserId")}),s.jsx(dr,{...L(t,"contactInfo")})]})},renderList:({form:r,verb:n,resource:o})=>(e.sites,ne(F),s.jsx(ce,{resource:F,fullHeight:!0,title:"Все объекты"}))})},$t=()=>{ve().contracts;const[t,r]=ne(_);return s.jsx(Lt,{resource:$e.CONTRACTS,renderForm:({item:n,id:o,verb:a,resource:i})=>{console.log("brandId",n);const c=B(G.selectValueEnumByBrandId(n.brandId));return s.jsxs(s.Fragment,{children:[s.jsx(ue,{...L(_,"contractNumber"),rules:[{required:!0}]}),s.jsx(Me.Item,{label:"Заказчик",required:!0,children:s.jsxs(Ee,{children:[s.jsx(pe,{...L(_,"brandId"),label:null,width:"sm",rules:[{required:!0}]}),s.jsx(pe,{...L(_,"legalId"),label:null,width:"md",valueEnum:c,rules:[{required:!0}]})]})}),s.jsx(Me.Item,{label:"Дата подписания",children:s.jsx(Ee,{children:s.jsxs(ee,{children:[s.jsx(ft,{...L(_,"signDate"),label:null,width:"sm",rules:[]}),s.jsx(Zn,{locale:"ru-RU",...L(_,"rate"),label:"Ставка за объект",width:"sm",rules:[]})]})})}),s.jsx(ft,{...L(_,"endDate"),label:"Действует до",width:"sm",rules:[]})]})},renderItemInfo:({verb:n,item:o,id:a,resource:i})=>{const c=ve(),u=c.subs.filter(l=>l.contractId===o.contractId);return c.sites.filter(l=>l.brandId==a),ne(F),c.legals.filter(l=>l.brandId==a),ne(G),s.jsx(ce,{createItemProps:{contractId:a},resource:se,title:"Подключённые объекты",rowData:u})},renderList:({form:n,verb:o,resource:a})=>s.jsx("div",{children:s.jsx(ce,{fullHeight:!0,resource:_,title:"Все договоры",columnDefs:[r.clickToEditCol,...t]})})})},_t=()=>(ve(),ne(se),s.jsx(Lt,{resource:se,renderForm:({item:e,id:t,verb:r,resource:n})=>{const o=B(_.selectById(e.contractId));o&&o.contractId;const a=o?o.legalId:void 0,i=B(G.selectById(a)),c=B(F.selectAll),u=F.asValueEnum(c.filter(l=>l.legalId===a));return s.jsxs(s.Fragment,{children:[s.jsx("div",{children:i?i.legalName:"Неизвестен"}),s.jsx(pe,{...L(se,"contractId"),rules:[{required:!0}]}),s.jsx(Me.Item,{label:"Период подключения",required:!0,children:s.jsxs(Ee,{children:[s.jsx(ft,{...L(se,"subscribeDate"),label:null,width:"sm",rules:[{required:!0}]}),s.jsx(ft,{...L(se,"unsubscribeDate"),label:null,width:"sm"})]})}),s.jsx(pe,{...L(se,"siteId"),valueEnum:u,label:"Объект",width:"sm",rules:[]})]})},renderItemInfo:({item:e,renderItemInfo:t,renderForm:r,renderList:n,id:o,resource:a,verb:i})=>{},renderList:({form:e,verb:t,resource:r})=>s.jsx("div",{children:s.jsx(ce,{fullHeight:!0,resource:se,title:"Все абонентские подключения"})})})),{confirm:Ni,info:Di}=Rt,Xr=e=>{const[t,r]=C.useState(!1);return s.jsxs(Q,{loading:t,hoverable:!0,style:{width:"450px",margin:"auto"},cover:s.jsx("img",{alt:"example",src:e.imgURL}),children:[s.jsx(Kn,{title:e.title,description:s.jsxs("p",{children:["Подготовьте excel файл с данными как показано в примере ",s.jsxs("a",{href:e.sampleFileURL,download:!0,children:["Образец импорта",e.title,".xlsx"]})]})}),s.jsx(ur,{accept:".xls, .xlsx",showUploadList:!1,beforeUpload:n=>{const o=new FileReader;return o.onload=async function(a){var i=a.target.result,c=Xn(i);const u=c.Sheets[c.SheetNames[0]],l=Jn.sheet_to_json(u,{header:e.xlsxCols});l.shift(),Ni({title:"Импортировать записи?",content:s.jsxs("div",{children:["Найдено ",s.jsx("b",{children:l.length})," ",e.importedItemsFound]}),okText:"Импорт",cancelText:"Отмена",onOk:async()=>{r(!0),await e.onImport(l),await Te(2e3),Di({title:"Записи успешно импортированы",content:e.title}),r(!1)}})},o.readAsArrayBuffer(n),!1},children:s.jsx(q,{icon:s.jsx(pr,{}),children:"Загрузить xls/xlsx файл"})}),";"]})},Pi=["brandName","legalName","city","address"];function*ki(e){let t=yield*je(yt);function*r(){t=yield*je(yt)}const n=[];function*o(a,i,c,u){let l=t.brandsByName[a];if(l)console.log(`Brand ${a} found`);else{const y=J.actions.added({brandId:me(),brandName:a});console.log(`Brand ${a} not found, create one`,y),yield*N(y),yield*re(Te,10),yield*re(r)}l=t.brandsByName[a];let p=t.legalsByName[i];if(!p){const y=G.actions.added({brandId:l.brandId,legalId:me(),legalName:i});console.log(`Legal ${i} not found, create one`,y),yield*N(y),yield*re(Te,10),yield*re(r)}p=t.legalsByName[i];let d=t.sites.find(y=>y.brandId===l.brandId&&y.legalId===p.legalId&&y.city===c&&y.address===u);if(!d){const y={brandId:l.brandId,legalId:p.legalId,city:c,address:u,siteId:me()};console.log("Site not found, create one",y.address),n.push(y)}return d}for(let a=0;a<e.length;a++){const i=e[a];yield*re(o,i.brandName,i.legalName,i.city,i.address)}n.length&&(yield*N(F.actions.addedBatch(n)))}const Oi=()=>{const e=ts(),t=async r=>{await e.runSaga(ki,r)};return s.jsx(fe,{children:s.jsx(Xr,{onImport:t,sampleFileURL:"/assets/import-objects-example.xlsx",xlsxCols:Pi,title:"Импорт объектов и заказчиков",imgURL:"/assets/import-objects-example.png",importedItemsFound:"объектов с данными об адресах и заказчиках"})})},Li=({issue:e})=>{const t=[{label:E.properties.estimationPrice.headerName,children:e.estimationPrice},{label:"Прибыль",children:e.estimationPrice-e.expensePrice},{label:E.properties.expensePrice.headerName,children:e.expensePrice},{label:"Маржинальность",children:e.estimationPrice&&e.expensePrice?((e.estimationPrice-e.expensePrice)/e.estimationPrice*100).toFixed(2)+"%":"-"}];return s.jsx(Yn,{column:2,title:"Показатели",size:"small",bordered:!0,children:t.map(({label:r,children:n},o)=>s.jsx(Qn,{label:r,children:n},o))})},{Text:Ks}=H,Ui=()=>{const e=et(),t=tt();console.log("EDITOR",t);const n=B(_.selectList).find(o=>o.contractId===t.item.contractId);return s.jsxs(Ie,{style:{maxWidth:800},...Hr,layout:"horizontal",children:[s.jsx(X,{meta:E.properties.brandId}),s.jsx(X,{meta:E.properties.legalId}),s.jsx(X,{style:{minWidth:"350px",maxWidth:"350px"},disabled:e!=="руководитель",placeholder:"Адрес не указан",meta:E.properties.siteId}),s.jsx(Ie.Item,{name:"contractId",label:"Договор",children:n?s.jsx(Ks,{type:"success",children:n.contractNumber}):s.jsx(Ks,{type:"warning",children:"Договор не найден"})}),s.jsx(X,{meta:E.fields.registerDate,disabled:!0}),s.jsx(X,{meta:E.properties.plannedDate,disabled:e==="сметчик"||e==="менеджер",width:"sm"}),s.jsx(X,{meta:E.properties.workStartedDate,disabled:e==="сметчик"||e==="менеджер",width:"sm"}),s.jsx(X,{meta:E.properties.completedDate,disabled:e==="сметчик"||e==="менеджер",width:"sm"}),s.jsx(X,{meta:E.properties.description,multiline:!0,disabled:e==="сметчик",width:"sm"}),s.jsx(X,{meta:E.properties.managerUserId,disabled:e==="сметчик",width:"sm"}),s.jsx(X,{meta:E.properties.clientsEngineerUserId,disabled:e==="сметчик",width:"sm"}),s.jsx(X,{meta:E.properties.techUserId,disabled:e==="сметчик",width:"sm"}),s.jsx(X,{meta:E.properties.contactInfo,multiline:!0,width:"sm"}),s.jsx(X,{meta:E.properties.status}),s.jsx(X,{meta:E.properties.estimationsApproved,width:"sm"}),s.jsx(Li,{issue:t.item})]})},Jr=e=>{const[t,r]=ea(!1);return s.jsxs(s.Fragment,{children:[s.jsx(q,{onClick:r,type:"dashed",danger:!0,children:"Импорт"}),s.jsx(Rt,{title:"Импорт",open:t,onOk:r,onCancel:r,children:s.jsx(Xr,{...e})})]})},Ai=({value:e,onValueChange:t,label:r,disabled:n,...o})=>s.jsx(Me.Item,{label:r,...o,children:s.jsx(wt,{checked:e,disabled:n,onChange:a=>{console.log("DatePicker onChange",a),t(a.target.checked)}})}),Bi=()=>{const{currentUser:e}=_e(),t=e.role==="руководитель"||e.role==="сметчик",r=tt(),{item:n,params:o,getRenFieldProps:a,updateItemProperty:i,hasChanges:c,errors:u,isValid:l}=r;n.issueId;const p=St(n.estimations||[]);C.useState(!1);const d=C.useRef(null);C.useMemo(()=>({width:"100%",height:"100%"}),[]);const y=C.useMemo(()=>({height:"300px",width:"100%"}),[]),h=p;console.log("ExpensesTable issue",n);const v=g=>{i("estimations")(g)},f=[{field:"title",headerName:"Наименование"},{field:"amount",headerName:"Расходы",cellEditor:"agNumberCellEditor"},{field:"comment",headerName:"Комментарий"},{cellRenderer:t?g=>s.jsx(q,{danger:!0,onClick:()=>{v(is(g.rowIndex,1,h))},children:"Удалить"}):"Смета"}],I=f.filter(g=>g.field).map(g=>g.field),S=C.useMemo(()=>({flex:1,minWidth:110,editable:t,resizable:!0}),[]),w=g=>{console.log("RowEditingStartedEvent",g)},T=g=>{let j=[];d.current.api.forEachNode(function(R){j.push(R.data)}),v(j),console.log("RowEditingStoppedEvent",g,j)},P=async g=>{console.log("onImport",g),v(g)},m=g=>s.jsx(Ai,{...L(E,g),value:n[g],onValueChange:i(g),disabled:!t,label:E.properties[g].headerName,width:"sm"}),b=C.useCallback(()=>{d.current.api.exportDataAsExcel()},[]);return s.jsxs("div",{children:[t?s.jsxs(H.Text,{type:"success",children:[" Ваша роль ",e.role,", редактируйте смету"]}):s.jsxs(H.Text,{type:"danger",children:["Ваша роль ",e.role,", нельзя смету"]}),m("estimationsApproved"),s.jsx("div",{className:"ag-theme-alpine",style:y,children:s.jsx(ss.AgGridReact,{localeText:fs,ref:d,rowData:h,columnDefs:f,defaultColDef:S,onCellEditingStarted:w,onCellEditingStopped:T})}),s.jsxs("div",{style:{paddingTop:"8px",display:"flex",justifyContent:"space-between"},children:[s.jsxs(ee,{children:[t?s.jsxs(s.Fragment,{children:[" ",s.jsx(Jr,{onImport:P,sampleFileURL:"/assets/import-estimations-example.xlsx",xlsxCols:I,title:"Импорт сметы",imgURL:"/assets/import-estimations-example.png",importedItemsFound:"позиций в смете"}),s.jsx(q,{type:"primary",onClick:()=>v([...h,{}]),children:"Добавить строку"})]}):s.jsxs(H.Text,{type:"danger",children:["Ваша роль ",e.role,", нельзя смету"]}),s.jsx(H.Text,{children:"Итого: "}),s.jsx(H.Text,{code:!0,strong:!0,children:n.estimationPrice})]}),s.jsx(ee,{children:s.jsx(q,{icon:s.jsx(ns,{}),onClick:b,children:"Скачать .xlsx"})})]})]})},Fi=()=>{const e=et();return e==="менеджер"||e==="руководитель"},Mi=e=>{const{currentUser:t}=_e(),{errors:r,item:n,getRenFieldProps:o,updateItemProperty:a,params:i,editor:c,hasChanges:u,resource:l,rules:p}=tt(),d=Fi(),y=St(n.expenses||[]),h=C.useRef(null);C.useMemo(()=>({width:"100%",height:"100%"}),[]);const v=C.useMemo(()=>({height:"300px",width:"100%"}),[]),f=y,I=j=>{a("expenses")(j)},S=[{field:"paymentType",headerName:"Оплата",cellEditor:"agSelectCellEditor",cellEditorParams:{values:["Наличные","Безналичные"]}},{field:"purposeType",headerName:"Назначение",cellEditor:"agSelectCellEditor",width:120,cellEditorParams:{values:["Материалы","Работы","ГСМ","Прочее"]}},{field:"title",headerName:"Наименование",width:140},{field:"amount",headerName:"Расходы",cellEditor:"agNumberCellEditor"},{field:"date",headerName:"Дата оплаты",cellEditor:"agDateCellEditor",cellClass:"dateISO"},{field:"comment",headerName:"Комментарий"},{cellRenderer:j=>s.jsx(q,{danger:!0,onClick:()=>{I(is(j.rowIndex,1,f))},children:"Удалить"})}],w=S.filter(j=>j.field).map(j=>j.field),T=C.useMemo(()=>({flex:1,minWidth:110,editable:d,resizable:!0}),[]),P=j=>{console.log("RowEditingStartedEvent",j)},m=j=>{let R=[];h.current.api.forEachNode(function(k){R.push(k.data)}),I(R),console.log("RowEditingStoppedEvent",j,R)},b=async j=>{console.log("onImport",j),I(j)},g=C.useCallback(()=>{h.current.api.exportDataAsExcel()},[]);return s.jsxs("div",{children:[d?s.jsxs(H.Text,{type:"success",children:[" Ваша роль ",t.role,", редактируйте смету"]}):s.jsxs(H.Text,{type:"danger",children:["Ваша роль ",t.role,", нельзя менять смету"]}),s.jsx("div",{className:"ag-theme-alpine",style:v,children:s.jsx(ss.AgGridReact,{localeText:fs,ref:h,rowData:f,columnDefs:S,defaultColDef:T,onCellEditingStarted:P,onCellEditingStopped:m})}),s.jsxs("div",{style:{paddingTop:"8px",display:"flex",justifyContent:"space-between"},children:[s.jsxs(ee,{children:[d?s.jsxs(s.Fragment,{children:[s.jsx(Jr,{onImport:b,sampleFileURL:"/assets/import-expenses-example.xlsx",xlsxCols:w,title:"Импорт расходов",imgURL:"/assets/import-expenses-example.png",importedItemsFound:"записей о расходах"}),s.jsx(q,{type:"primary",onClick:()=>I([...f,{paymentType:"Безналичные",purpuseType:"Материалы"}]),children:"Добавить строку"})]}):s.jsxs(H.Text,{type:"danger",children:["Ваша роль ",t.role,", нельзя смету"]}),s.jsx(H.Text,{children:"Итого: "}),s.jsx(H.Text,{code:!0,strong:!0,children:n.expensePrice})]}),s.jsx(ee,{children:s.jsx(q,{icon:s.jsx(ns,{}),onClick:g,children:"Скачать .xlsx"})})]})]})},Vi=e=>new Promise((t,r)=>{const n=new FileReader;n.readAsDataURL(e),n.onload=()=>t(n.result),n.onerror=o=>r(o)}),Ht=({onItemsChange:e,items:t,maxCount:r,issueId:n,label:o})=>{const a=et(),i=r||1,[c,u]=C.useState(!1),[l,p]=C.useState(""),[d,y]=C.useState(""),h=()=>u(!1),v=async w=>{!w.url&&!w.preview&&(w.preview=await Vi(w.originFileObj)),p(w.url||w.preview),u(!0),y(w.name||w.url.substring(w.url.lastIndexOf("/")+1))},f=({fileList:w})=>e(w),I=w=>{console.log("handleRemove",w);const T=P=>m=>m.name===P;e(is(t.findIndex(T(w.name)),1,t))},S=s.jsxs("div",{children:[s.jsx(rs,{}),s.jsx("div",{style:{marginTop:8},children:"Upload"})]});return s.jsxs(Q,{title:o,children:[s.jsx(ur,{action:"/api/upload/"+n,listType:"picture-card",fileList:t,onPreview:v,onRemove:I,onChange:f,multiple:!0,maxCount:i,disabled:a==="сметчик",children:t.length>=r?null:S}),s.jsx(Rt,{open:c,title:d,footer:null,onCancel:h,children:s.jsx("img",{alt:"example",style:{width:"100%"},src:l})})]})},qi=e=>e.reduce((t,r)=>t+(isNaN(Number(r.amount))?0:Number(r.amount)),0),Gi=e=>e.reduce((t,r)=>t+(isNaN(Number(r.amount))?0:Number(r.amount)),0),$i=Ot(E,{clientsEngineerUserId:zr,managerUserId:js,techUserId:Zr,status:{getParams:({value:e,property:t,state:r,role:n,currentUserId:o,item:a})=>({options:Is(E.properties.status.enum).map(i=>{if(n==="менеджер"){const c=Dr[a.status];i.disabled=!c.includes(i.value)}return i})}),getUpdate:({value:e,role:t,item:r})=>e==="В работе"?{...r,workStartedDate:he.today(),status:e}:e==="Выполнена"?{...r,completedDate:he.today(),status:e}:{...r,status:e}},estimations:{getUpdate:({item:e,value:t})=>({...e,estimationPrice:Gi(t),estimations:t})},expenses:{getUpdate:({item:e,value:t})=>({...e,expensePrice:qi(t),expenses:t})},brandId:{getUpdate:({item:e,value:t})=>t!==e.brandId?{...e,siteId:void 0,legalId:void 0,contractId:void 0,subId:void 0,brandId:t}:e},legalId:{getUpdate:({item:e,value:t,state:r})=>{if(t!==e.legalId){const n={...e,siteId:void 0,legalId:t,contractId:void 0,subId:void 0};return e.brandId===void 0&&(n.brandId=G.selectById(t)(r).brandId),n}return{...e,legalId:t}},getParams:({item:e,value:t,state:r})=>({options:G.asOptions(G.selectAll(r).filter(n=>e.brandId?n.brandId===e.brandId:!0)),addNewItemDefaults:{}})},siteId:{getUpdate:({item:e,value:t,state:r})=>{const n=t;if(n!==void 0&&n!==e.siteId){const{sites:o,subs:a,contracts:i}=r.app.bootstrap,c=o.find(d=>d.siteId===n),u=a.find(d=>d.siteId===n),l=u?i.find(d=>d.contractId===u.contractId):void 0;let p={...e,siteId:n};return e.brandId||(p.brandId=c.brandId),e.legalId||(p.legalId=c.legalId),u&&l&&c&&(p={...p,contractId:l.contractId,siteId:n,subId:u.subId,contactInfo:c.contactInfo,clientsEngineerUserId:c.clientsEngineerUserId}),e.clientsEngineerUserId===void 0&&c&&c.clientsEngineerUserId&&(p.clientsEngineerUserId=c.clientsEngineerUserId),e.managerUserId===void 0&&c&&c.managerUserId&&(p.managerUserId=c.managerUserId),e.techUserId===void 0&&c&&c.techUserId&&(p.techUserId=c.techUserId),p}return{...e,siteId:n}},getParams:({item:e,state:t})=>{var r=F.selectAll(t);return e.brandId&&(r=r.filter(n=>n.brandId===e.brandId)),e.legalId&&(r=r.filter(n=>n.legalId===e.legalId)),console.log("options",r),{options:F.asOptions(r),addNewItemDefaults:{}}}}}),_i=({id:e})=>{const t=xs($i,e);E.properties;const r=(n,o,a=1)=>(t.getRenFieldProps(n),{items:t.item[n],onItemsChange:i=>{t.getRenFieldProps(n).updateItemProperty(i)},issueId:t.item.issueId,label:o,maxCount:a});return s.jsx(kt.Provider,{value:t,children:s.jsx(bs,{children:s.jsxs(xe,{tabs:{type:"card"},children:[s.jsx(xe.TabPane,{tab:"Заявка",children:s.jsx(Ui,{})},"tab1"),s.jsx(xe.TabPane,{tab:"Смета",children:s.jsx(Bi,{})},"tab2"),s.jsx(xe.TabPane,{tab:"Расходы",children:s.jsx(Mi,{})},"tab3"),s.jsxs(xe.TabPane,{tab:"Файлы",children:[s.jsx(Ht,{...r("checkFiles","Чеки",10)}),s.jsx(Ht,{...r("actFiles","Акты",5)}),s.jsx(Ht,{...r("workFiles","Работы",70)})]},"tab4")]})})})},Xs=(e,t=void 0)=>{const r=localStorage.getItem(e),n=r?JSON.parse(r):t,[o,a]=C.useState(n);return[o,c=>{a(c),localStorage.setItem(n,JSON.stringify(c))}]},Hi=({statuses:e,setStatuses:t})=>s.jsx(ee,{size:[0,8],wrap:!0,children:ps.map(r=>e.includes(r)?s.jsx(Xe,{style:{cursor:"pointer",border:"1px"},onClick:()=>{const n=Re(o=>o===r,e);t(n)},color:Pr[r],children:r}):s.jsx(Xe,{style:{cursor:"pointer"},onClick:()=>{t([...e,r])},children:r}))}),Wi=C.forwardRef((e,t)=>{const[r,n]=C.useState(e.value),o=C.useRef(null),a=Se(),i=B(E.selectById(e.data.issueId)),c=l=>p=>a(E.actions.patched({issueId:i.issueId,[l]:p}));C.useEffect(()=>{o.current.focus()},[]);const u=et();return C.useImperativeHandle(t,()=>({getValue(){return r},isCancelBeforeStart(){return!1},isCancelAfterEnd(){return r>1e3}})),s.jsx(zt,{options:Is(E.properties.status.enum).map(l=>{if(u==="менеджер"){const p=Dr[i.status];l.disabled=!p.includes(l.value)}return l}),placeholder:"Статус не указан",onChange:l=>{l==="В работе"&&c("workStartedDate")(he.today()),l==="Выполнена"&&c("completedDate")(he.today()),c("status")(l)},ref:o,value:r,style:{width:"100%"}})}),zi=async(e,t)=>{const r=t.getState(),n=yt(r),o=async d=>{const y=d.langRU.plural;let h=e.sheetsByTitle[y];const v=Js(d),f=["Ипорт",...v.map(w=>w.headerName)];h&&await h.delete(),h=await e.addSheet({headerValues:f,title:y,gridProperties:{rowCount:1,columnCount:f.length}});const S=d.selectList(t.getState()).map(w=>{const T={};return v.forEach(P=>{w[P.name]!==void 0&&(T[P.name]=w[P.name])}),T});await h.addRows(S,{})};await o(F),await o($);const a=e.sheetsByIndex[0],c=["Импорт",...Js(E).map(d=>d.name)],u=d=>c.indexOf(d),l=(d,y)=>{const h=u(y);if(!(h<0))return a.getCell(d,h).value};await a.setHeaderRow(c),console.log(a.rowCount),await a.loadCells("Заявки");for(let d=1;d<a.rowCount;d++){const y={rowIndex:d,importedStatus:a.getCell(d,0).value,item:{},errors:{}};E.fieldsList.forEach(h=>{const v=l(d,h.headerName);if(h.linkedResourceName){const f=$e[h.linkedResourceName];let I=n.getLinkedResByName(h.linkedResourceName,v);v&&!I?y.errors[h.name]=[`${f.langRU.singular} с определением ${v} не существует`]:y.item[h.name]=I[f.idProp]}else y.item[h.name]=v,h.required&&!v&&(y.errors[h.name]=[`Требуется указать ${h.headerName}`])});for(var p=1;p<a.columnCount;p++)a.g}},Js=e=>e.fieldsList.filter(t=>t.type!=="array"&&t.isIDProp===!1&&t.internal!==!0),Zi="1OpeniUQU1I_VX0E0_NKygOVVSvPBpBdz6ML8XzVkRNk",Ki=()=>{const e=ts(),t=async()=>{const r=await Pt(),n=new ta(Zi,{token:await r.getNewGToken()});await n.loadInfo();const o=await zi(n,e);console.log(o)};return s.jsx(q,{icon:s.jsx(pr,{}),onClick:t})},Xi=e=>e.estimationsApproved===!0?s.jsx(Xe,{color:"green",children:"Да"}):s.jsx(Xe,{color:"red",children:"Нет"}),Ji=e=>{const t=V(),r=e.plannedDate?V(e.plannedDate):void 0;e.completedDate&&V(e.completedDate),e.workStartedDate&&V(e.workStartedDate),e.registerDate&&V(e.registerDate);let o=(()=>s.jsx(Xe,{color:Pr[e.status],children:e.status}))();return e.status==="В работе"&&t.isAfter(r)&&(o=s.jsx(Ut,{count:t.diff(r,"d"),offset:[8,12],children:o})),e.status==="Выполнена"&&(e.plannedDate&&e.completedDate&&V(e.completedDate).isAfter(e.plannedDate)&&(o=s.jsx(Ut,{color:"lightpink",count:V(e.completedDate).diff(V(e.plannedDate),"d"),offset:[-2,5],children:o})),(!e.plannedDate||!e.completedDate)&&(o=s.jsx(Ut,{count:s.jsx(aa,{style:{color:"#d5540a"}}),offset:[5,10],children:o}))),s.jsx(s.Fragment,{children:o})},Ys=()=>{const e=mr(),t=window.location.hash===""?void 0:window.location.hash.slice(1);console.log("RouteMatch ",e);const r=B(E.selectAll),{currentUser:n}=_e(),o=Se(),a=I=>{console.log(I)},[i,c]=ne(E),u=[{...c.clickToEditCol,headerName:"id",width:30},{...c.clientsIssueNumber,width:100,cellRenderer:I=>s.jsx("a",{onClick:()=>{sa(I.value),ra.info('Cкопировано "'+I.value+'"')},children:I.value})},{...c.registerDate},{field:"status",filter:"agSetColumnFilter",filterParams:{applyMiniFilterWhileTyping:!0},headerName:"Статус",width:125,editable:n.role!=="сметчик",onCellValueChanged:I=>{const S={issueId:I.data.issueId,status:I.newValue};I.newValue==="Выполнена"&&(S.completedDate=V().startOf("d").toISOString()),o(E.actions.patched(S))},cellEditor:Wi,cellEditorParams:{values:I=>[I.data.status,"sd"],valueListGap:0},cellRenderer:I=>Ji(I.data)},{...c.brandId,width:65},{...c.siteId,width:170},{...c.description,width:260},{...c.plannedDate,headerName:"План"},{...c.completedDate,headerName:"Завершена"},{...c.estimationsApproved,headerName:"Смета",cellRenderer:I=>Xi(I.data),width:80},{...c.estimationPrice,editable:!1,width:80},{...c.expensePrice,editable:!1,width:80}],[l,p]=Xs("statusFilter",ps),[d,y]=Xs("outdatedFilter",!1),h=d?r.filter(I=>us(I)&&!(I.status==="Выполнена"&&!I.completedDate)):r,v=n.role==="менеджер"?h.filter(I=>I.managerUserId===n.userId):h;console.log("statuses",l),C.useRef(null);const f=v.filter(I=>l.includes(I.status));return s.jsx(fe,{hidePageContainer:!0,proLayout:{contentStyle:{padding:"0px"}},children:s.jsxs("div",{children:[t?s.jsx(_i,{id:t}):null,s.jsx(ce,{toolbar:s.jsxs(ee,{children:[s.jsx(wt,{checked:d,onChange:I=>y(I.target.checked),children:"Просроченные"}),s.jsx(Hi,{statuses:l,setStatuses:p})]}),rowData:f,onCreateClick:a,fullHeight:!0,resource:E,columnDefs:u,title:"Все заявки",bottomBar:({ag:I})=>{const S=async()=>{const w=I.api.getDataAsExcel({}),T=new FormData;T.append("file[]",w,"report.xlsx");const P=await Qt.post("/api/email-export?images=true&email=",T,{headers:{"Content-Type":`multipart/form-data; boundary=${T._boundary}`}});console.log(P.data);const m=P.data.url,b=document.createElement("a");b.href=m,b.download=m,document.body.appendChild(b),b.click(),document.body.removeChild(b)};return s.jsxs(ee,{children:[s.jsx(q,{icon:s.jsx(na,{}),onClick:S,children:"Выгрузить заявки"}),s.jsx(Ki,{})]})}})]})})},Yi=({value:e,onValueChange:t,label:r,disabled:n,...o})=>s.jsx(Me.Item,{shouldUpdate:!0,label:r,...o,children:s.jsx(as,{disabled:n,locale:cr,value:e===void 0?void 0:V(e),onChange:a=>{t(a&&a.toDate().toISOString())}})}),{Text:Qs,Link:bl}=H,Qi=()=>{const{currentUser:e}=_e(),t={labelCol:{span:6},wrapperCol:{span:18}},r=E,n=C.useRef(),o=E.idProp,a=me(),i=Kr(),c=he.today().add(3,"day"),u={[o]:a,...i,checkFiles:[],actFiles:[],workFiles:[],responsibleManagerId:e.userId,status:"Новая",expensePrice:0,estimationPrice:0,expenses:[],estimations:[],plannedDate:c.toString(),registerDate:he.today()},[l,p]=C.useState(u),d=Se(),y=async D=>{const K={[o]:a,...D},U=E.actions.added(K);console.log("Submit",D,U),d(U)};console.log("Initial alues",u);const h=oe(),v=()=>{var D;(D=n.current)==null||D.submit()},f=()=>h.goBack(),I=s.jsx("span",{children:"Новая заявка"}),S=B(J.selectList),w=J.asValueEnum(S),T=B(G.selectList),[P,m]=C.useState({}),b=B(F.selectList),[g,j]=C.useState({}),R=D=>{var ae,ie,Pe;(ae=n.current)==null||ae.setFieldValue("legalId",void 0),(ie=n.current)==null||ie.setFieldValue("siteId",void 0);const K=(Pe=n.current)==null?void 0:Pe.getFieldValue("brandId"),U=G.asValueEnum(T.filter(st=>st.brandId===K));m(U),console.log("onBrandChange",D,U)},k=D=>{var ae,ie;(ae=n.current)==null||ae.setFieldValue("siteId",void 0);const K=(ie=n.current)==null?void 0:ie.getFieldValue("legalId"),U=F.asValueEnum(b.filter(Pe=>Pe.legalId===K));j(U),console.log("onLegalChange",D,U)},te=B(_.selectList),z=B(se.selectList);z.find(D=>D.siteId===l.siteId);const Z=te.find(D=>D.contractId===l.contractId),De=D=>{var Pe,st,Ss;const K=(Pe=n.current)==null?void 0:Pe.getFieldValue("siteId"),U=b.find(He=>He.siteId===K),ae=z.find(He=>He.siteId===K)||{contractId:void 0},ie=te.find(He=>He.contractId===ae.contractId);ae&&ie&&U&&((st=n.current)==null||st.setFieldValue("contractId",ie.contractId),(Ss=n.current)==null||Ss.setFieldValue("subId",ae.subId),p({...l,contractId:ie.contractId,subId:ae.subId,contactInfo:U.contactInfo,clientsEngineerUserId:U.clientsEngineerUserId}))};console.log("contractId",l.contractId,Z),console.log("siteId",l.siteId);const we=D=>s.jsx(Yi,{...L(E,D),value:l[D],onValueChange:K=>{const U={...l,[D]:K};p(U)},label:E.properties[D].headerName,width:"sm"});return s.jsx(fe,{proLayout:{extra:[s.jsx(Qe,{onCancel:f}),s.jsx(q,{type:"primary",icon:s.jsx(Et,{}),onClick:v,disabled:!(l.siteId&&Z&&Z.contractId),children:"Создать"})],title:"Rengin"},onBack:f,title:s.jsx(os,{items:[{href:qe(r).view(),title:r.langRU.plural},{title:I}]}),children:s.jsxs(vs,{formRef:n,layout:"horizontal",...t,readonly:!1,initialValues:u,onValuesChange:(D,K)=>{console.log(K),p({...l,...K})},onFinish:async D=>{console.log("onFinish",D),console.log("state",l);debugger;y(l),await Te(100),h.replace(le().issuesEdit({issueId:l.issueId}))},submitter:{render:D=>null},children:[s.jsx(ue,{...L(E,"clientsIssueNumber"),required:!0,placeholder:"Введите номер заявки",rules:[{required:!0}]}),s.jsx(pe,{showSearch:!0,label:"Заказчик",placeholder:"Выберите заказчика",required:!0,valueEnum:w,name:"brandId",onChange:R,rules:[{required:!0}]}),s.jsx(pe,{showSearch:!0,disabled:l.brandId===void 0,label:"Организация",placeholder:"Выберите организацию",required:!0,valueEnum:P,name:"legalId",onChange:k,rules:[{required:!0}]}),s.jsx(pe,{showSearch:!0,disabled:l.legalId===void 0,label:"Адрес",placeholder:"Выберите адрес",required:!0,valueEnum:g,name:"siteId",onChange:De,rules:[{required:!0}]}),s.jsx(Ie.Item,{name:"contractId",label:"Договор",children:Z?s.jsx(Qs,{type:"success",children:Z.contractNumber}):s.jsx(Qs,{type:"warning",children:"Договор не найден"})}),we("registerDate"),we("plannedDate"),we("workStartedDate"),we("completedDate"),s.jsx(dr,{...L(E,"description")})]})})},lt=({issues:e,color:t})=>{const r=B($.selectAll),n=[{name:"Всего",value:e.length},...r.map(o=>({name:o.fullName,value:e.filter(a=>a.managerUserId===o.userId).length})).filter(o=>o.value>0),{name:"Не задан",value:e.filter(o=>o.managerUserId===void 0).length}];return s.jsx(oa,{width:"100%",height:"100%",children:s.jsxs(ia,{width:500,height:300,data:n,margin:{top:5,right:30,left:20,bottom:5},children:[s.jsx(la,{strokeDasharray:"3 3"}),s.jsx(ca,{dataKey:"name"}),s.jsx(da,{}),s.jsx(ua,{}),s.jsx(pa,{dataKey:"value",fill:t||"pink",activeBar:s.jsx(ma,{fill:t||"pink",stroke:t})})]})})};V.extend(sr);const{RangePicker:el}=as,ct={width:"50%",height:"300px",textAlign:"center"},tl=()=>{const[e,t]=C.useState([V("2023/11/01"),V("2023/11/03")]),r=e[0],n=e[1],a=B(E.selectAll).filter(he.isIssueInPeriod(e)),i=a.filter(he.isIssueActive),c=a.filter(y=>y.status==="Выполнена"),u=i.filter(y=>V(y.registerDate).isBetween(r,n)),l=a.filter(he.isIssueOutdated),p=l.filter(y=>y.status==="Выполнена"||y.status==="Отменена"),d=l.filter(y=>y.status==="В работе");return s.jsx(fe,{hidePageContainer:!0,proLayout:{contentStyle:{padding:"0px"}},children:s.jsxs(Q,{title:"Графики",children:[s.jsxs(Q.Grid,{style:{width:"100%",height:"80px"},children:["Период: ",s.jsx(el,{value:e,onChange:y=>{console.log("onChange",y),t(y)}})]}),s.jsxs(Q.Grid,{style:ct,children:[s.jsx("b",{children:"Новые заявки"}),s.jsx(lt,{issues:u,color:"green"})]}),s.jsxs(Q.Grid,{hoverable:!1,title:"Закрытые",style:ct,children:[s.jsx("b",{children:"Закрыто за период"}),s.jsx(lt,{issues:c,color:"orange"})]}),s.jsxs(Q.Grid,{style:ct,title:"Просрочено в закрытых",children:[s.jsx("b",{children:"Просрочено в закрытых за период"}),s.jsx(lt,{issues:p,color:"blue"})]}),s.jsxs(Q.Grid,{style:ct,title:"Просрочено в работе",children:[s.jsx("b",{children:"Просрочено в работе в течении пероида"}),s.jsx(lt,{issues:d,color:"red"})]})]})})},sl=Ot($,{}),rl=({id:e})=>{const t=xs(sl,e),{removed:r,...n}=$.properties;return s.jsx(kt.Provider,{value:t,children:s.jsx(bs,{children:s.jsx(Wr,{list:Array.from(Object.values(n))})})})},nl=()=>{const t=ve().users.list;ne($),mr();const r=window.location.hash===""?void 0:window.location.hash.slice(1);return oe(),s.jsx(fe,{hidePageContainer:!0,proLayout:{contentStyle:{padding:"0px"}},children:s.jsxs("div",{children:[r?s.jsx(rl,{id:r}):null,s.jsx(ce,{fullHeight:!0,title:"Пользователи",resource:$,rowData:t})]})})},A=(e,t)=>{const r=Go(e);return Object.assign(r,{Component:t})},le=tr(()=>({index:A("/",()=>s.jsx("div",{})),login:A("/app/login",ii),forgot:A("/app/forgot",li),start:A("/app/in/start",mi),usersList:A("/app/in/users",nl),brandsList:A("/app/in/brands",wi),legalsList:A("/app/in/legals",qt),legalsCreate:A("/app/in/legals/create",qt),legalsEdit:A("/app/in/legals/:legalId",qt),sitesList:A("/app/in/sites",Gt),sitesCreate:A("/app/in/sites/create",Gt),sitesEdit:A("/app/in/sites/:siteId",Gt),contractsList:A("/app/in/contracts",$t),contractsCreate:A("/app/in/contracts/create",$t),contractsEdit:A("/app/in/contracts/:contractsId",$t),subsList:A("/app/in/subs",_t),subsCreate:A("/app/in/subs/create",_t),subsEdit:A("/app/in/subs/:subId",_t),importSites:A("/app/in/import-sites",Oi),issues:A("/app/in/issues",Ys),issueCreate:A("/app/in/issues/create",Qi),issuesEdit:A("/app/in/issues/:issueId",Ys),dashboard:A("/app/in/dashboard",tl)})),al=()=>Object.values(le()).map(({Component:e,pattern:t,exact:r})=>s.jsx(ha,{exact:!0,path:t,render:n=>s.jsx(e,{...n,...n.match.params})},t)),ol=()=>{const e=document.getElementById("preloader");e&&e.parentElement&&(e.parentElement.removeChild(e),e.remove())},il=()=>{const e=Object.fromEntries(new URLSearchParams(window.location.search));if(e.password&&e.email)return{password:e.password,email:e.email,remember:!0,pathname:window.location.pathname}};function*ll(e){const t=yield*re(Pt);for(window.restApi=t;;){const r=e.location.pathname,n=il()||Le.getItem("credentials");(!r||r=="/")&&(yield*re(Te,200));let o=window.location.pathname;o.endsWith("/login")||o.length<2?(yield*N(O.actions.preloaded(void 0)),e.replace(le().login()),Le.removeItem("credentials")):n?yield*be(function*(){yield*re(hr,100),yield*N(O.actions.loginRequested({...n}))}):(e.replace(le().login()),yield*N(O.actions.preloaded(void 0)),Le.removeItem("credentials"));let a={bootstrap:{}};for(;;)try{const u=yield*Ke(O.actions.loginRequested.isType),{email:l,password:p}=u.payload;a=yield*re(t.fetchBootstrap,{email:l,password:p}),yield*N(O.actions.loggedIn({email:l,password:p})),yield*N(hs.actions.fetchBootstrap.done(a));const d=Object.entries(ms).map(([f,I])=>I.actions.reset(a.bootstrap[f]));for(const f of d)yield*N(f);const y=a.bootstrap.users.find(f=>f.email===l);yield*N(O.actions.setLogin(l));const v=(yield*je(It.selectPreferences)).role;console.log("login result",a);break}catch(u){console.error(u),Le.removeItem("credentials"),yield*N(O.actions.unbusy("Login")),yield*N(O.actions.preloaded(void 0)),window.location.pathname.startsWith("/app/login")||e.replace(le().login())}yield*N(O.actions.busy("fetchAdminState")),yield*N(O.actions.unbusy("Login")),yield*be(Mr);const i=yield*je(gs);yield*be(Ao);const c={userId:i.userId,storeGuid:"S"+me()};yield*N(ye.actions.gatewayChanged(Vr.getSSERoute(c))),yield*N(Dt.actions.metaUpdated(c)),yield*N(O.actions.unbusy("fetchAdminState")),yield*N(O.actions.unbusy("fetchAdminState")),window.location.pathname==="/app/login"&&e.push(le().issues()),yield*N(O.actions.preloaded(void 0)),ol(),yield*N(O.actions.unbusy("Login")),yield*Ke(O.actions.logout.isType),yield*re(Te,100),yield*N(O.actions.loggedOut(void 0)),yield*N(O.actions.setLogin("")),Le.removeItem("credentials")}}const cl="0.3.8";function*dl(e,t){yield*be(Mr),yield*be(_o,t),yield*be(Yo);const r={};for(r.VERSION=cl,yield*N(Ur.actions.reset(r));;){const n=yield*be(ll,t);yield*Ke(O.actions.logout.isType),yield*ga(n),t.replace(le().login({})),yield*re(hr,100)}}const ul=e=>{const[t]=C.useState(al());return fa.useToken(),B(O.selectUI).preloaded?s.jsx(ya,{children:t}):s.jsx(xa,{children:s.jsx(rr,{spinning:!0})})},pl=ls.createDB(),ml={issuesTable:ls.createTable(pl,"issues")({primary:"issueId",indexes:["userId","clientsIssueNumber","legalId"]})},hl=({store:e})=>{const[t,r]=C.useState(!1);return ba(()=>{r(!0)}),s.jsx(Ia.BlinkDbProvider,{db:ls.createDB(),model:ml,children:s.jsx(ja,{store:e,children:s.jsx(va,{history:Ze,children:s.jsx(Vo,{history:Ze,children:s.jsx("div",{id:"test-pro-layout",style:{height:"100vh"},children:s.jsx(Sa,{theme:{components:{Form:{marginLG:4,lineHeight:2}},token:{borderRadius:0}},componentSize:"middle",locale:wa,autoInsertSpaceInButton:!0,getTargetContainer:()=>document.getElementById("test-pro-layout")||document.body,renderEmpty:()=>s.jsx(Ca,{description:!1}),children:t&&s.jsx(ul,{history:Ze})})})})})})})};window.ducks=Bo;window.axios=Qt;document.getElementById("root");const jt=ni();jt.runSaga(dl,jt,Ze);window.store=jt;window.R=Ra;const gl=Ea.createRoot(document.getElementById("root"));gl.render(or.createElement(hl,{store:jt}));
